import { st_range, to_query } from 'app/Utils/Index.js';
import { get_bbox } from 'app/Utils/Utils.js';

class RequestAdapter {
    constructor({layer = 'AFB4D363768E4C5FAC71C9B0C6F7B2F4', gmxResourceServer, authorized}){
        this._layer = layer;
        this._gmxResourceServer = gmxResourceServer;
        this._geometries = [];
        this._authorized = authorized;
    }
    set criteria (value) {
        this._criteria = value;
    }
    get criteria () {
        return this._criteria;
    }
    get satellites () {        
        let {satellites, archive} = this._criteria;
        let serialize = s => Object.keys(s).reduce((a,k) => a.concat(s[k]), []);
        let ss = serialize(satellites.ms).concat(serialize(satellites.pc));
        return `(${ss.filter(x => x.checked).map(x => `(${x.condition(archive, this._authorized)})`).join(' OR ')})`;
    }
    get geometries () {
        return this._geometries;
    }
    set geometries (value) {
        this._geometries = value;
    }
    get geometry () {        
        return {
            type: 'GeometryCollection',
            geometries: this._geometries,
        };
    }
    get hasGeometry() {
        return Array.isArray (this._geometries) && this._geometries.length > 0;
    }
    _formatDate (date) {                
        return moment(date).format('YYYY-MM-DD') ;
    }
    get date () {
        let {date, annually} = this._criteria;
        let [dateStart, dateEnd] = date;
        if (annually) {
            let dcr = [];
            let startMonth = dateStart.getMonth();
            let startDay = dateStart.getDate();
            let endMonth = dateEnd.getMonth();
            let endDay = dateEnd.getDate();
            let endYear = dateEnd.getFullYear();
            if (startMonth > endMonth) {
                --endYear;
            }
            for (let year = dateStart.getFullYear(); year <= endYear; year++) {
                let start = new Date(year, startMonth, startDay);
                let end = new Date(startMonth > endMonth ? year + 1 : year, endMonth, endDay);
                dcr.push(`(acqdate >= '${this._formatDate(start)}' AND acqdate <= '${this._formatDate(end)}')`);
            }
            return `(${dcr.join(' OR ')})`;
        }
        else {
            return `(acqdate >= '${this._formatDate (dateStart)}' AND acqdate <= '${this._formatDate(dateEnd)}')`;
        }
    }
    get clouds () {
        let { clouds } = this._criteria;
        let [min, max] = clouds;
        return `(cloudness IS NULL OR cloudness < 0 OR (cloudness >= ${min.toFixed(1)} AND cloudness <= ${max.toFixed(1)}))`;
    }
    get angle() {
        let { angle } = this._criteria;
        let [min, max] = angle;
        return `(tilt IS NULL OR tilt < 0 OR (tilt >= ${min.toFixed(1)} AND tilt <= ${max.toFixed(1)}))`;
    }
    get stereo () {
        let { stereo } = this._criteria;
        return stereo ? "NOT (stereo IS NULL OR stereo = 'NONE')" : '';
    }
    get spatial () {        
        return `Intersects([geomixergeojson], buffer(GeometryFromGeoJson('${JSON.stringify(this.geometry)}', 4326), 0.001))`
    }
    get archive () {
        let { archive } = this._criteria;
        switch(archive){ 
            case 'global':
                return 'islocal = FALSE';
            case 'local':
                return 'islocal = TRUE';
            default:
            case 'all':
                return '';
        }
    }
    get st_index () {
        let {date: [start, end], annually} = this._criteria;
        let boxes = this.geometries.reduce ((a, g) => {
            a.push (get_bbox (g));
            return a;
        }, []);    
        return to_query (st_range (start, end, boxes));
    }
    get query() {        
        return [
            this.st_index,
            this.spatial,     
            this.date,
            this.satellites,                   
        ]
        .filter(x => x.trim() !== '')
        .join(' AND ');
    }
    get request () {
        return {
            out_cs: 'EPSG:3857',
            layer: this._layer,
            orderby: 'acqdate',
            orderdirection: 'desc',
            geometry: true,
            page: 0,
            pagesize: 0,
            count: 'add',
            query: this.query,
        };
    }
    search(limit = 0){
        return new Promise((resolve, reject) => {
            let rq = this.request;
            rq.pagesize = limit;
            // var response = {
            //     "Status": "ok",
            //     "Result": {
            //       "fields": [
            //         "sceneid",
            //         "acqdate",
            //         "acqtime",
            //         "cloudness",
            //         "tilt",
            //         "sunelev",
            //         "stereo",
            //         "url",
            //         "x1",
            //         "y1",
            //         "x2",
            //         "y2",
            //         "x3",
            //         "y3",
            //         "x4",
            //         "y4",
            //         "volume",
            //         "platform",
            //         "spot5_a_exists",
            //         "spot5_b_exists",
            //         "islocal",
            //         "product",
            //         "gmx_id",
            //         "sensor",
            //         "local_exists",
            //         "spot5id",
            //         "stidx",
            //         "geomixergeojson"
            //       ],
            //       "types": [
            //         "string",
            //         "date",
            //         "time",
            //         "float",
            //         "float",
            //         "float",
            //         "string",
            //         "string",
            //         "float",
            //         "float",
            //         "float",
            //         "float",
            //         "float",
            //         "float",
            //         "float",
            //         "float",
            //         "string",
            //         "string",
            //         "boolean",
            //         "boolean",
            //         "boolean",
            //         "boolean",
            //         "integer",
            //         "string",
            //         "boolean",
            //         "string",
            //         "integer",
            //         "geometry"
            //       ],
            //       "Count": 16,
            //       "values": [
            //         [
            //           "1030010078060700",
            //           1515542400,
            //           0,
            //           27,
            //           6,
            //           12.27728,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=1030010078060700&imageHeight=1024&imageWidth=1024",
            //           37.59754650000001,
            //           56.03957199999999,
            //           38.6478925,
            //           56.03957199999999,
            //           38.6478925,
            //           54.989226,
            //           37.59754650000001,
            //           54.989226,
            //           null,
            //           "WV02",
            //           false,
            //           false,
            //           false,
            //           false,
            //           126098644,
            //           null,
            //           false,
            //           null,
            //           12661147,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4258172.95,
            //                   7359775.53
            //                 ],
            //                 [
            //                   4229431.91,
            //                   7359842.04
            //                 ],
            //                 [
            //                   4229418.42,
            //                   7367964.66
            //                 ],
            //                 [
            //                   4229407.38,
            //                   7376085.14
            //                 ],
            //                 [
            //                   4229393.38,
            //                   7384213.07
            //                 ],
            //                 [
            //                   4229375.54,
            //                   7392346.4
            //                 ],
            //                 [
            //                   4229359.57,
            //                   7400491.26
            //                 ],
            //                 [
            //                   4229339.61,
            //                   7408642.91
            //                 ],
            //                 [
            //                   4229320.65,
            //                   7416808.99
            //                 ],
            //                 [
            //                   4229299.72,
            //                   7424988.65
            //                 ],
            //                 [
            //                   4229273.74,
            //                   7433185.03
            //                 ],
            //                 [
            //                   4229244.3,
            //                   7441401.52
            //                 ],
            //                 [
            //                   4229217.06,
            //                   7449640
            //                 ],
            //                 [
            //                   4229184.82,
            //                   7457899.83
            //                 ],
            //                 [
            //                   4229157.7,
            //                   7466192.72
            //                 ],
            //                 [
            //                   4229122.65,
            //                   7474501.97
            //                 ],
            //                 [
            //                   4229089.06,
            //                   7482845.86
            //                 ],
            //                 [
            //                   4229046.8,
            //                   7491215.42
            //                 ],
            //                 [
            //                   4229007.73,
            //                   7499626.77
            //                 ],
            //                 [
            //                   4228965.86,
            //                   7508063.76
            //                 ],
            //                 [
            //                   4228919.18,
            //                   7516543.46
            //                 ],
            //                 [
            //                   4228870.41,
            //                   7525065.86
            //                 ],
            //                 [
            //                   4228824.09,
            //                   7533636.03
            //                 ],
            //                 [
            //                   4228773.44,
            //                   7542251.73
            //                 ],
            //                 [
            //                   4228716.41,
            //                   7550902.21
            //                 ],
            //                 [
            //                   4228658.44,
            //                   7559604.79
            //                 ],
            //                 [
            //                   4228620.56,
            //                   7565681.69
            //                 ],
            //                 [
            //                   4258982.97,
            //                   7566297.39
            //                 ],
            //                 [
            //                   4258941.56,
            //                   7560177.16
            //                 ],
            //                 [
            //                   4258892.69,
            //                   7551435.44
            //                 ],
            //                 [
            //                   4258841.77,
            //                   7542734.27
            //                 ],
            //                 [
            //                   4258795.18,
            //                   7534088.86
            //                 ],
            //                 [
            //                   4258745.56,
            //                   7525483.3
            //                 ],
            //                 [
            //                   4258701.51,
            //                   7516924.22
            //                 ],
            //                 [
            //                   4258658.25,
            //                   7508406.65
            //                 ],
            //                 [
            //                   4258611.02,
            //                   7499927.09
            //                 ],
            //                 [
            //                   4258572.12,
            //                   7491489.47
            //                 ],
            //                 [
            //                   4258535.28,
            //                   7483085.48
            //                 ],
            //                 [
            //                   4258501.03,
            //                   7474722.27
            //                 ],
            //                 [
            //                   4258467.98,
            //                   7466385.73
            //                 ],
            //                 [
            //                   4258433.28,
            //                   7458072.65
            //                 ],
            //                 [
            //                   4258402.94,
            //                   7449785.71
            //                 ],
            //                 [
            //                   4258370.08,
            //                   7441520.69
            //                 ],
            //                 [
            //                   4258341.4,
            //                   7433277.41
            //                 ],
            //                 [
            //                   4258319.11,
            //                   7425060.94
            //                 ],
            //                 [
            //                   4258292.76,
            //                   7416860.03
            //                 ],
            //                 [
            //                   4258272.17,
            //                   7408675.49
            //                 ],
            //                 [
            //                   4258250.11,
            //                   7400503.77
            //                 ],
            //                 [
            //                   4258230.5,
            //                   7392340.66
            //                 ],
            //                 [
            //                   4258211.35,
            //                   7384190.6
            //                 ],
            //                 [
            //                   4258196.78,
            //                   7376046.72
            //                 ],
            //                 [
            //                   4258181.34,
            //                   7367911.57
            //                 ],
            //                 [
            //                   4258172.95,
            //                   7359775.53
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "1030010077314900",
            //           1515542400,
            //           0,
            //           37,
            //           14,
            //           12.35806,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=1030010077314900&imageHeight=1024&imageWidth=1024",
            //           37.82859400000001,
            //           56.04288799999999,
            //           38.888645,
            //           56.04288799999999,
            //           38.888645,
            //           54.982837,
            //           37.82859400000001,
            //           54.982837,
            //           null,
            //           "WV02",
            //           false,
            //           false,
            //           false,
            //           false,
            //           126098646,
            //           null,
            //           false,
            //           null,
            //           12661147,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4254551.02,
            //                   7565812.33
            //                 ],
            //                 [
            //                   4285573.06,
            //                   7566958.36
            //                 ],
            //                 [
            //                   4285541.68,
            //                   7557881.04
            //                 ],
            //                 [
            //                   4285519.06,
            //                   7548844.06
            //                 ],
            //                 [
            //                   4285501.12,
            //                   7539827.11
            //                 ],
            //                 [
            //                   4285480.24,
            //                   7530826.84
            //                 ],
            //                 [
            //                   4285452.9,
            //                   7521835.23
            //                 ],
            //                 [
            //                   4285431.14,
            //                   7512877.22
            //                 ],
            //                 [
            //                   4285413.63,
            //                   7503948.06
            //                 ],
            //                 [
            //                   4285385.9,
            //                   7495018.78
            //                 ],
            //                 [
            //                   4285362.02,
            //                   7486118.24
            //                 ],
            //                 [
            //                   4285347.98,
            //                   7477250.88
            //                 ],
            //                 [
            //                   4285328.67,
            //                   7468394.78
            //                 ],
            //                 [
            //                   4285307.19,
            //                   7459551.64
            //                 ],
            //                 [
            //                   4285293.45,
            //                   7450740.63
            //                 ],
            //                 [
            //                   4285279.22,
            //                   7441952.31
            //                 ],
            //                 [
            //                   4285258.46,
            //                   7433167.05
            //                 ],
            //                 [
            //                   4285233.94,
            //                   7424395.82
            //                 ],
            //                 [
            //                   4285211.87,
            //                   7415647.86
            //                 ],
            //                 [
            //                   4285192.25,
            //                   7406919.96
            //                 ],
            //                 [
            //                   4285185.05,
            //                   7398226.53
            //                 ],
            //                 [
            //                   4285157.53,
            //                   7389524.01
            //                 ],
            //                 [
            //                   4285127.24,
            //                   7380836.3
            //                 ],
            //                 [
            //                   4285107.31,
            //                   7372178.98
            //                 ],
            //                 [
            //                   4285092.98,
            //                   7363546.43
            //                 ],
            //                 [
            //                   4285087.22,
            //                   7359679.25
            //                 ],
            //                 [
            //                   4255020.57,
            //                   7358535.85
            //                 ],
            //                 [
            //                   4255011.74,
            //                   7362420.56
            //                 ],
            //                 [
            //                   4254997.3,
            //                   7371060.65
            //                 ],
            //                 [
            //                   4254983,
            //                   7379718.77
            //                 ],
            //                 [
            //                   4254967.44,
            //                   7388390.26
            //                 ],
            //                 [
            //                   4254953.52,
            //                   7397084.96
            //                 ],
            //                 [
            //                   4254936.44,
            //                   7405797.82
            //                 ],
            //                 [
            //                   4254914.21,
            //                   7414516.67
            //                 ],
            //                 [
            //                   4254892.78,
            //                   7423254.39
            //                 ],
            //                 [
            //                   4254877.03,
            //                   7432022.66
            //                 ],
            //                 [
            //                   4254854.02,
            //                   7440798.29
            //                 ],
            //                 [
            //                   4254844.8,
            //                   7449616.24
            //                 ],
            //                 [
            //                   4254822.29,
            //                   7458433.53
            //                 ],
            //                 [
            //                   4254799.43,
            //                   7467269.86
            //                 ],
            //                 [
            //                   4254772.4,
            //                   7476114.32
            //                 ],
            //                 [
            //                   4254748.07,
            //                   7484986.48
            //                 ],
            //                 [
            //                   4254729.74,
            //                   7493887.54
            //                 ],
            //                 [
            //                   4254707.35,
            //                   7502802.64
            //                 ],
            //                 [
            //                   4254687.91,
            //                   7511744.78
            //                 ],
            //                 [
            //                   4254665.8,
            //                   7520703.12
            //                 ],
            //                 [
            //                   4254644.63,
            //                   7529688.19
            //                 ],
            //                 [
            //                   4254617.17,
            //                   7538680.29
            //                 ],
            //                 [
            //                   4254595.84,
            //                   7547711.71
            //                 ],
            //                 [
            //                   4254574.88,
            //                   7556755.03
            //                 ],
            //                 [
            //                   4254551.02,
            //                   7565812.33
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "102001006C128E00",
            //           1515542400,
            //           0,
            //           94,
            //           28,
            //           6.564217,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=102001006C128E00&imageHeight=1024&imageWidth=1024",
            //           38.29481200000001,
            //           56.03061700000001,
            //           38.675825,
            //           56.03061700000001,
            //           38.675825,
            //           55.649604,
            //           38.29481200000001,
            //           55.649604,
            //           null,
            //           "WV01",
            //           false,
            //           false,
            //           false,
            //           false,
            //           126099363,
            //           null,
            //           false,
            //           null,
            //           12661147,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4305174.91,
            //                   7506710.69
            //                 ],
            //                 [
            //                   4262973.71,
            //                   7510057.03
            //                 ],
            //                 [
            //                   4262981.56,
            //                   7520290.56
            //                 ],
            //                 [
            //                   4262973.32,
            //                   7530506.39
            //                 ],
            //                 [
            //                   4262959,
            //                   7540709.17
            //                 ],
            //                 [
            //                   4262962.77,
            //                   7546644.8
            //                 ],
            //                 [
            //                   4305373.21,
            //                   7544483.08
            //                 ],
            //                 [
            //                   4305337.87,
            //                   7538352.15
            //                 ],
            //                 [
            //                   4305270.05,
            //                   7527822.2
            //                 ],
            //                 [
            //                   4305236.7,
            //                   7517272.64
            //                 ],
            //                 [
            //                   4305174.91,
            //                   7506710.69
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "102001006B28B400",
            //           1515542400,
            //           0,
            //           0,
            //           27,
            //           6.305054,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=102001006B28B400&imageHeight=1024&imageWidth=1024",
            //           37.784495,
            //           56.514241000000005,
            //           38.162978,
            //           56.514241000000005,
            //           38.162978,
            //           56.135758,
            //           37.784495,
            //           56.135758,
            //           null,
            //           "WV01",
            //           false,
            //           false,
            //           false,
            //           false,
            //           126099364,
            //           null,
            //           false,
            //           null,
            //           12660891,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4247844.82,
            //                   7605415.77
            //                 ],
            //                 [
            //                   4206400.5,
            //                   7604177.61
            //                 ],
            //                 [
            //                   4206333.3,
            //                   7614260.25
            //                 ],
            //                 [
            //                   4206258.7,
            //                   7624413.61
            //                 ],
            //                 [
            //                   4206181.63,
            //                   7634613.88
            //                 ],
            //                 [
            //                   4206150.82,
            //                   7640251.06
            //                 ],
            //                 [
            //                   4248283.35,
            //                   7642646.45
            //                 ],
            //                 [
            //                   4248207.57,
            //                   7636828.11
            //                 ],
            //                 [
            //                   4248048.01,
            //                   7626291.69
            //                 ],
            //                 [
            //                   4247954.38,
            //                   7615817.8
            //                 ],
            //                 [
            //                   4247844.82,
            //                   7605415.77
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "1040010035A7E600",
            //           1515283200,
            //           10800,
            //           96,
            //           28,
            //           11.51893,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=1040010035A7E600&imageHeight=1024&imageWidth=1024",
            //           37.165093999999996,
            //           56.450342500000005,
            //           37.451634,
            //           56.450342500000005,
            //           37.451634,
            //           56.1638025,
            //           37.165093999999996,
            //           56.1638025,
            //           null,
            //           "WV03",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125525417,
            //           null,
            //           false,
            //           null,
            //           12660891,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4137269.77,
            //                   7630488.29
            //                 ],
            //                 [
            //                   4169070.07,
            //                   7632703.44
            //                 ],
            //                 [
            //                   4169019.08,
            //                   7626168.05
            //                 ],
            //                 [
            //                   4169025.88,
            //                   7619651.58
            //                 ],
            //                 [
            //                   4169060.93,
            //                   7613141.85
            //                 ],
            //                 [
            //                   4169096.86,
            //                   7609151.26
            //                 ],
            //                 [
            //                   4137199.43,
            //                   7606897.48
            //                 ],
            //                 [
            //                   4137224.89,
            //                   7610947.05
            //                 ],
            //                 [
            //                   4137266.07,
            //                   7617467.34
            //                 ],
            //                 [
            //                   4137242.19,
            //                   7623968.87
            //                 ],
            //                 [
            //                   4137269.77,
            //                   7630488.29
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "102001006DAF4800",
            //           1515196800,
            //           10800,
            //           99,
            //           25,
            //           6.621264,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=102001006DAF4800&imageHeight=1024&imageWidth=1024",
            //           37.945327,
            //           55.8203995,
            //           38.274644,
            //           55.8203995,
            //           38.274644,
            //           55.4910825,
            //           37.945327,
            //           55.4910825,
            //           null,
            //           "WV01",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125528742,
            //           null,
            //           false,
            //           null,
            //           12661147,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4260713.94,
            //                   7468608.86
            //                 ],
            //                 [
            //                   4224054.53,
            //                   7473121.09
            //                 ],
            //                 [
            //                   4224141.61,
            //                   7483987.58
            //                 ],
            //                 [
            //                   4224222.38,
            //                   7494733.42
            //                 ],
            //                 [
            //                   4224288.07,
            //                   7505377.4
            //                 ],
            //                 [
            //                   4224325.05,
            //                   7511824.69
            //                 ],
            //                 [
            //                   4260433.55,
            //                   7508021.59
            //                 ],
            //                 [
            //                   4260470.2,
            //                   7501473.76
            //                 ],
            //                 [
            //                   4260546.99,
            //                   7490643.44
            //                 ],
            //                 [
            //                   4260627.24,
            //                   7479691.37
            //                 ],
            //                 [
            //                   4260713.94,
            //                   7468608.86
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "102001006E600C00",
            //           1515196800,
            //           10800,
            //           99,
            //           18,
            //           6.037898,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=102001006E600C00&imageHeight=1024&imageWidth=1024",
            //           37.98276799999999,
            //           56.47936,
            //           38.300185,
            //           56.47936,
            //           38.300185,
            //           56.161942999999994,
            //           37.98276799999999,
            //           56.161942999999994,
            //           null,
            //           "WV01",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125528744,
            //           null,
            //           false,
            //           null,
            //           12660891,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4263557.09,
            //                   7604165.05
            //                 ],
            //                 [
            //                   4228222.49,
            //                   7606399.79
            //                 ],
            //                 [
            //                   4228248.79,
            //                   7616081.13
            //                 ],
            //                 [
            //                   4228246.84,
            //                   7625740.05
            //                 ],
            //                 [
            //                   4228274.6,
            //                   7635337.81
            //                 ],
            //                 [
            //                   4228273.11,
            //                   7640908.99
            //                 ],
            //                 [
            //                   4263536.41,
            //                   7639273.66
            //                 ],
            //                 [
            //                   4263533.68,
            //                   7633610.03
            //                 ],
            //                 [
            //                   4263532.98,
            //                   7623836.16
            //                 ],
            //                 [
            //                   4263537.16,
            //                   7614024.1
            //                 ],
            //                 [
            //                   4263557.09,
            //                   7604165.05
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "105001000DA40F00",
            //           1515110400,
            //           10800,
            //           85,
            //           22,
            //           10.96014,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=105001000DA40F00&imageHeight=1024&imageWidth=1024",
            //           36.77262900000001,
            //           55.670512,
            //           37.051126,
            //           55.670512,
            //           37.051126,
            //           55.392015,
            //           36.77262900000001,
            //           55.392015,
            //           null,
            //           "GE01",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125517724,
            //           null,
            //           false,
            //           null,
            //           12661146,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4124277.35,
            //                   7451499.83
            //                 ],
            //                 [
            //                   4093773.22,
            //                   7453992.82
            //                 ],
            //                 [
            //                   4093688.17,
            //                   7462476.31
            //                 ],
            //                 [
            //                   4093597.65,
            //                   7471063.17
            //                 ],
            //                 [
            //                   4093511.16,
            //                   7479742.9
            //                 ],
            //                 [
            //                   4093510.38,
            //                   7479854.04
            //                 ],
            //                 [
            //                   4124512.51,
            //                   7476994.13
            //                 ],
            //                 [
            //                   4124511.7,
            //                   7476901.56
            //                 ],
            //                 [
            //                   4124421.43,
            //                   7468342.98
            //                 ],
            //                 [
            //                   4124353.28,
            //                   7459859.87
            //                 ],
            //                 [
            //                   4124277.35,
            //                   7451499.83
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "1040010037C27700",
            //           1515110400,
            //           10800,
            //           99,
            //           13,
            //           11.03315,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=1040010037C27700&imageHeight=1024&imageWidth=1024",
            //           38.190956,
            //           56.338558000000006,
            //           38.414342000000005,
            //           56.338558000000006,
            //           38.414342000000005,
            //           56.115172,
            //           38.190956,
            //           56.115172,
            //           null,
            //           "WV03",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125522408,
            //           null,
            //           false,
            //           null,
            //           12660891,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4251397.84,
            //                   7614734.94
            //                 ],
            //                 [
            //                   4276265.01,
            //                   7613929.78
            //                 ],
            //                 [
            //                   4276258.28,
            //                   7608044.14
            //                 ],
            //                 [
            //                   4276237.57,
            //                   7602179.22
            //                 ],
            //                 [
            //                   4276219.21,
            //                   7596318.44
            //                 ],
            //                 [
            //                   4276211.64,
            //                   7592703.6
            //                 ],
            //                 [
            //                   4251460.61,
            //                   7593482.47
            //                 ],
            //                 [
            //                   4251448.1,
            //                   7597095.82
            //                 ],
            //                 [
            //                   4251429.1,
            //                   7602972.37
            //                 ],
            //                 [
            //                   4251413.58,
            //                   7608852.03
            //                 ],
            //                 [
            //                   4251397.84,
            //                   7614734.94
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "1040010037426500",
            //           1515110400,
            //           10800,
            //           99,
            //           11,
            //           11.10345,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=1040010037426500&imageHeight=1024&imageWidth=1024",
            //           38.091453,
            //           56.2558945,
            //           38.31425899999999,
            //           56.2558945,
            //           38.31425899999999,
            //           56.033088500000005,
            //           38.091453,
            //           56.033088500000005,
            //           null,
            //           "WV03",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125522404,
            //           null,
            //           false,
            //           null,
            //           12660891,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4265072.4,
            //                   7576780.44
            //                 ],
            //                 [
            //                   4240343.74,
            //                   7576957.42
            //                 ],
            //                 [
            //                   4240343.81,
            //                   7582682.03
            //                 ],
            //                 [
            //                   4240331.61,
            //                   7588423.15
            //                 ],
            //                 [
            //                   4240323.54,
            //                   7594171.8
            //                 ],
            //                 [
            //                   4240321.15,
            //                   7597701.35
            //                 ],
            //                 [
            //                   4265123.8,
            //                   7597297.12
            //                 ],
            //                 [
            //                   4265104.35,
            //                   7593824.97
            //                 ],
            //                 [
            //                   4265095.38,
            //                   7588131.41
            //                 ],
            //                 [
            //                   4265090.06,
            //                   7582447.08
            //                 ],
            //                 [
            //                   4265072.4,
            //                   7576780.44
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "10400100364C1000",
            //           1515110400,
            //           10800,
            //           99,
            //           24,
            //           11.27932,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=10400100364C1000&imageHeight=1024&imageWidth=1024",
            //           37.926345,
            //           56.068524999999994,
            //           38.17559399999999,
            //           56.068524999999994,
            //           38.17559399999999,
            //           55.819276,
            //           37.926345,
            //           55.819276,
            //           null,
            //           "WV03",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125522397,
            //           null,
            //           false,
            //           null,
            //           12660891,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4221942.16,
            //                   7557521.61
            //                 ],
            //                 [
            //                   4249687.79,
            //                   7560825.37
            //                 ],
            //                 [
            //                   4249675.11,
            //                   7554225.71
            //                 ],
            //                 [
            //                   4249647.48,
            //                   7547615.31
            //                 ],
            //                 [
            //                   4249615.61,
            //                   7541005.38
            //                 ],
            //                 [
            //                   4249587.2,
            //                   7536939.34
            //                 ],
            //                 [
            //                   4221992.99,
            //                   7533710.69
            //                 ],
            //                 [
            //                   4221985.53,
            //                   7537725.29
            //                 ],
            //                 [
            //                   4221964.26,
            //                   7544309.95
            //                 ],
            //                 [
            //                   4221941.47,
            //                   7550898.82
            //                 ],
            //                 [
            //                   4221942.16,
            //                   7557521.61
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "104001003730C400",
            //           1515110400,
            //           10800,
            //           99,
            //           22,
            //           11.82606,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=104001003730C400&imageHeight=1024&imageWidth=1024",
            //           37.351469,
            //           55.4702175,
            //           37.593539,
            //           55.4702175,
            //           37.593539,
            //           55.2281475,
            //           37.351469,
            //           55.2281475,
            //           null,
            //           "WV03",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125522401,
            //           null,
            //           false,
            //           null,
            //           12661147,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4157946.55,
            //                   7439884.95
            //                 ],
            //                 [
            //                   4184893.63,
            //                   7442519.37
            //                 ],
            //                 [
            //                   4184870.1,
            //                   7436252.52
            //                 ],
            //                 [
            //                   4184852.13,
            //                   7429996.85
            //                 ],
            //                 [
            //                   4184831.51,
            //                   7423749.9
            //                 ],
            //                 [
            //                   4184822.65,
            //                   7419934.15
            //                 ],
            //                 [
            //                   4158026.69,
            //                   7417365.91
            //                 ],
            //                 [
            //                   4158018.7,
            //                   7421153.12
            //                 ],
            //                 [
            //                   4157996.52,
            //                   7427389.05
            //                 ],
            //                 [
            //                   4157972.92,
            //                   7433635.05
            //                 ],
            //                 [
            //                   4157946.55,
            //                   7439884.95
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "10300100773C3800",
            //           1514851200,
            //           10800,
            //           99,
            //           8,
            //           11.25067,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=10300100773C3800&imageHeight=1024&imageWidth=1024",
            //           37.976686,
            //           55.697672,
            //           38.242312,
            //           55.697672,
            //           38.242312,
            //           55.432046,
            //           37.976686,
            //           55.432046,
            //           null,
            //           "WV02",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125518665,
            //           null,
            //           false,
            //           null,
            //           12661147,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4227545.43,
            //                   7484716.35
            //                 ],
            //                 [
            //                   4257114.79,
            //                   7484407.33
            //                 ],
            //                 [
            //                   4257086.72,
            //                   7475983.79
            //                 ],
            //                 [
            //                   4257058.33,
            //                   7467576.51
            //                 ],
            //                 [
            //                   4257035.32,
            //                   7459853.12
            //                 ],
            //                 [
            //                   4227604.9,
            //                   7460116.38
            //                 ],
            //                 [
            //                   4227585.25,
            //                   7467851.26
            //                 ],
            //                 [
            //                   4227568.83,
            //                   7476269.33
            //                 ],
            //                 [
            //                   4227545.43,
            //                   7484716.35
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "1030010076644000",
            //           1514851200,
            //           10800,
            //           99,
            //           27,
            //           10.55517,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=1030010076644000&imageHeight=1024&imageWidth=1024",
            //           37.980653,
            //           56.3931325,
            //           38.300019,
            //           56.3931325,
            //           38.300019,
            //           56.0737665,
            //           37.980653,
            //           56.0737665,
            //           null,
            //           "WV02",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125518650,
            //           null,
            //           false,
            //           null,
            //           12660891,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4227987.01,
            //                   7618281.8
            //                 ],
            //                 [
            //                   4263538.62,
            //                   7623473.19
            //                 ],
            //                 [
            //                   4263533.49,
            //                   7612664.14
            //                 ],
            //                 [
            //                   4263515.9,
            //                   7601811.7
            //                 ],
            //                 [
            //                   4263491.96,
            //                   7591832.15
            //                 ],
            //                 [
            //                   4228003.23,
            //                   7586631.15
            //                 ],
            //                 [
            //                   4228000.65,
            //                   7596573.47
            //                 ],
            //                 [
            //                   4227993.35,
            //                   7607435.59
            //                 ],
            //                 [
            //                   4227987.01,
            //                   7618281.8
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "1030010076464500",
            //           1514851200,
            //           10800,
            //           99,
            //           8,
            //           10.56452,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=1030010076464500&imageHeight=1024&imageWidth=1024",
            //           37.834001,
            //           56.3689915,
            //           38.107889,
            //           56.3689915,
            //           38.107889,
            //           56.0951035,
            //           37.834001,
            //           56.0951035,
            //           null,
            //           "WV02",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125518661,
            //           null,
            //           false,
            //           null,
            //           12660891,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4211661.74,
            //                   7617071.81
            //                 ],
            //                 [
            //                   4242150.82,
            //                   7617328.48
            //                 ],
            //                 [
            //                   4242128.46,
            //                   7608824.37
            //                 ],
            //                 [
            //                   4242104.17,
            //                   7600330.42
            //                 ],
            //                 [
            //                   4242074.95,
            //                   7592448.78
            //                 ],
            //                 [
            //                   4211742.01,
            //                   7592190.4
            //                 ],
            //                 [
            //                   4211716.69,
            //                   7600061.56
            //                 ],
            //                 [
            //                   4211689.49,
            //                   7608561.2
            //                 ],
            //                 [
            //                   4211661.74,
            //                   7617071.81
            //                 ]
            //               ]
            //             ]
            //           }
            //         ],
            //         [
            //           "104001003554D600",
            //           1514764800,
            //           10800,
            //           99,
            //           28,
            //           11.03993,
            //           "NONE",
            //           "https://browse.digitalglobe.com/imagefinder/showBrowseImage?catalogId=104001003554D600&imageHeight=1024&imageWidth=1024",
            //           37.197933,
            //           56.311617500000004,
            //           37.489646,
            //           56.311617500000004,
            //           37.489646,
            //           56.0199045,
            //           37.197933,
            //           56.0199045,
            //           null,
            //           "WV03",
            //           false,
            //           false,
            //           false,
            //           false,
            //           125515159,
            //           null,
            //           false,
            //           null,
            //           12660891,
            //           {
            //             "type": "POLYGON",
            //             "coordinates": [
            //               [
            //                 [
            //                   4140914.53,
            //                   7603935.16
            //                 ],
            //                 [
            //                   4173270.28,
            //                   7602537.63
            //                 ],
            //                 [
            //                   4173269.79,
            //                   7596041.26
            //                 ],
            //                 [
            //                   4173309.04,
            //                   7589528.72
            //                 ],
            //                 [
            //                   4173315.36,
            //                   7583022.22
            //                 ],
            //                 [
            //                   4173328.37,
            //                   7579055.09
            //                 ],
            //                 [
            //                   4140879.63,
            //                   7580449.68
            //                 ],
            //                 [
            //                   4140855.02,
            //                   7584459.85
            //                 ],
            //                 [
            //                   4140866.49,
            //                   7590955.45
            //                 ],
            //                 [
            //                   4140877.35,
            //                   7597452.35
            //                 ],
            //                 [
            //                   4140914.53,
            //                   7603935.16
            //                 ]
            //               ]
            //             ]
            //           }
            //         ]
            //       ]
            //     },
            //     "CallbackName": "id0.59126934539093431"
            //   };
            // resolve(response.Result);
            this._gmxResourceServer.sendPostRequest('VectorLayer/Search.ashx', rq)
            .then(response => {                 
                if(response.Status === 'ok'){
                    resolve(response.Result);
                }
                else {
                    reject(response);
                }
            })
            .catch(e => reject(e));
        });
    }
}

export { RequestAdapter };