{"version":3,"file":"permalink.min.js","sources":["../node_modules/scanex-event-target/index.js","../node_modules/scanex-jsonp-request/index.js","../node_modules/scanex-auth/src/AuthManager/AuthManager.js","../node_modules/scanex-object-extensions/index.js","../node_modules/scanex-auth/node_modules/scanex-dropdown-widget/src/DropdownWidget.js","../node_modules/scanex-auth/node_modules/scanex-dropdown-widget/src/DropdownMenuWidget.js","../node_modules/scanex-translations/index.js","../node_modules/scanex-auth/src/AuthWidget/AuthWidget.js","../node_modules/scanex-auth/src/AuthManager/Server.js","../node_modules/scanex-auth/src/AuthManager/ResourceServer.js","../node_modules/scanex-auth/src/AuthManager/api.js","../node_modules/scanex-async/index.js","../src/app/Utils/Utils.js","../src/permalink.js"],"sourcesContent":["class EventTarget {\r\n    constructor() {\r\n        this.listeners = {};\r\n    }\r\n    addEventListener(type, callback) {\r\n        if(!(type in this.listeners)) {\r\n            this.listeners[type] = [];\r\n        }\r\n        this.listeners[type].push(callback);\r\n    }\r\n    removeEventListener (type, callback) {\r\n        if(!(type in this.listeners)) {\r\n            return;\r\n        }\r\n        let stack = this.listeners[type];\r\n        for(let i = 0, l = stack.length; i < l; i++) {\r\n            if(stack[i] === callback){\r\n                stack.splice(i, 1);\r\n                return this.removeEventListener(type, callback);\r\n            }\r\n        }\r\n    }\r\n    dispatchEvent(event) {\r\n        if(!(event.type in this.listeners)) {\r\n            return;\r\n        }\r\n        let stack = this.listeners[event.type];\r\n\t    Object.defineProperty(event, 'target', {\r\n            enumerable: false,\r\n            configurable: false,\r\n            writable: false,\r\n            value: this\r\n        });\r\n        for(let i = 0, l = stack.length; i < l; i++) {\r\n            stack[i].call(this, event);\r\n        }\r\n    }\r\n}\r\n\r\nexport default EventTarget;","let uniqueGlobalName = (() => {\r\n    let freeid = 0;\r\n    return thing => {\r\n        let id = `gmx_unique_${freeid++}`;\r\n        window[id] = thing;\r\n        return id;\r\n    };\r\n})();\r\n\r\n\r\n/** Посылает кросс-доменный GET запрос к серверу с использованием транспорта JSONP.\r\n *\r\n * @memberOf nsGmx.Utils\r\n * @param {String} url URL сервера.\r\n * @param {Function} callback Ф-ция, которая будет вызвана при получении от сервера результата.\r\n * @param {String} [callbackParamName=CallbackName] Имя параметра для задания имени ф-ции ответа.\r\n * @param {Function} [errorCallback] Ф-ция, которая будет вызвана в случае ошибки запроса к серверу\r\n */\r\nfunction sendCrossDomainJSONRequest (url, callback, callbackParamName, errorCallback) {\r\n\tcallbackParamName = callbackParamName || 'CallbackName';\r\n\r\n    let script = document.createElement(\"script\");\r\n\tscript.setAttribute(\"charset\", \"UTF-8\");\r\n\tlet callbackName = uniqueGlobalName(obj => {\r\n\t\tcallback && callback(obj);\r\n\t\twindow[callbackName] = false;\r\n\t\tdocument.getElementsByTagName(\"head\").item(0).removeChild(script);\r\n\t});\r\n\r\n    let sepSym = url.indexOf('?') == -1 ? '?' : '&';\r\n\r\n    if (errorCallback) {\r\n        script.onerror = errorCallback;\r\n    }\r\n\r\n\tscript.setAttribute(\"src\", `${url}${sepSym}${callbackParamName}=${callbackName}&${Math.random()}`);\r\n\tdocument.getElementsByTagName(\"head\").item(0).appendChild(script);\r\n}\r\n\r\nexport { sendCrossDomainJSONRequest };","import EventTarget from 'scanex-event-target';\r\nimport { sendCrossDomainJSONRequest } from 'scanex-jsonp-request';\r\n\r\nclass AuthManager extends EventTarget {\r\n    constructor({\r\n        authorizationEndpoint, \r\n        userInfoEndpoint, \r\n        redirectEndpointHtml, \r\n        redirectEndpointAshx,         \r\n        credentialLoginEndpoint,\r\n        clientId = 1}){\r\n        super();\r\n        // поддерживаем как минимум два события для\r\n        // серверов ресурсов: login и logout\r\n        this._authorizationEndpoint = authorizationEndpoint;\r\n        this._userInfoEndpoint = userInfoEndpoint;\r\n        this._redirectEndpointHtml = redirectEndpointHtml;\r\n        this._redirectEndpointAshx = redirectEndpointAshx;\r\n        this._redirectEndpointAshx2 = `${redirectEndpointAshx}/?return_url=${location.href}`;\r\n        this._credentialLoginEndpoint = credentialLoginEndpoint;\r\n        this._resourceServers = [];\r\n        this._clientId = clientId;\r\n    }\r\n    $getAntiCsrfToken() {\r\n        const cookieName = \"sync\";\r\n        const re = new RegExp(`.*${cookieName}=([^;]+).*`, 'i');\r\n        return document.cookie.replace(re, '$1');        \r\n    }\r\n    /** Добавляет сервер ресурсов\r\n     * Должна вызываться только из класса ResourceServer.\r\n     * @param {ResourceServer} resourceServer\r\n     */\r\n    $addResourceServer (resourceServer) {\r\n        this._resourceServers.push(resourceServer);\r\n    }    \r\n    _chain (tasks, state) {        \r\n        return tasks.reduce(\r\n            (prev, next) => prev.then(next),\r\n            new Promise ((resolve, reject) => resolve (state))\r\n        );\r\n    }\r\n    _authorizeResourceServers () {\r\n        let tasks = this._resourceServers.map(rs => {\r\n            return state => {\r\n                return new Promise(resolve => {\r\n                    rs.sendGetRequest('oAuth2/LoginDialog.ashx')\r\n                    .then(response => {\r\n                        state = state.concat(response);\r\n                        resolve(state);\r\n                    })\r\n                    .catch(e => state.push(e));\r\n                });\r\n            };\r\n        });\r\n        return this._chain(tasks, []);\r\n    }\r\n    _processAuthorization (search){\r\n        function parseQueryString (search) {\r\n            let a = search.slice(1).split('&');\r\n            let o = {};\r\n            for (let i = 0; i < a.length; i++) {\r\n                let s = a[i].split('=');\r\n                o[s[0]] = s[1];\r\n            }\r\n            return o;\r\n        }\r\n        return new Promise((resolve, reject) => {            \r\n            // превращаем строку с параметрами в хеш\r\n            let params = parseQueryString(search);\r\n\r\n            if (params.error) {\r\n                reject({\r\n                    Status: 'auth',\r\n                    Result: null,\r\n                    Error: {\r\n                        message: params.error\r\n                    }\r\n                });\r\n            } else {\r\n                sendCrossDomainJSONRequest(`${this._redirectEndpointAshx}${search}`,\r\n                resp => {\r\n                    if (resp.Status === 'ok') {\r\n                        resolve({\r\n                            Status: 'ok',\r\n                            Result: resp.Result\r\n                        });\r\n                    } else {\r\n                        reject({\r\n                            Status: resp.Status,\r\n                            Result: null\r\n                        });\r\n                    }\r\n                }, \r\n                'CallbackName', \r\n                () => {\r\n                    reject({\r\n                        Status: 'network',\r\n                        Result: null,\r\n                        Error: {\r\n                            message: arguments[2]\r\n                        }\r\n                    });\r\n                });                \r\n            }\r\n        });\r\n    }\r\n    /** Получение информации о пользователе от AuthServer\r\n     * @return {Function} promise(userInfo)\r\n     */\r\n    getUserInfo(){\r\n        if (this._getUserInfoDeferred) {\r\n            return this._getUserInfoDeferred;\r\n        }        \r\n        return this._getUserInfoDeferred = new Promise((resolve, reject) => {\r\n\r\n            function authorizationGrant(search) {\r\n                // удаляем айфрейм и глобальную переменную\r\n                setTimeout(function() {\r\n                    delete window.authorizationGrant;\r\n                    document.body.removeChild (document.body.querySelector('.authorizationIframe'));                    \r\n                }, 0);\r\n\r\n                this._processAuthorization(search).then(resp => resolve(resp), (err) => reject(err));\r\n            }\r\n\r\n            // посылаем запросы на все сервера ресурсов\r\n            // когда они все ответят ..\r\n            this._authorizeResourceServers()\r\n            .then(servers => {\r\n                // .. формируем параметры state и scope\r\n                let scope = '';\r\n                let state = '';\r\n                for (let i = 0; i < servers.length; i++) {\r\n                    let response = servers[i];\r\n                    scope += response.Service.ServerId + ',';\r\n                    state += response.Result.State + ',';\r\n                }\r\n                scope = scope.slice(0, -1);\r\n                state = state.slice(0, -1);\r\n\r\n                // .. и посылаем запрос на сервер авторизации\r\n                window.authorizationGrant = authorizationGrant.bind(this);\r\n                document.body.insertAdjacentHTML('afterbegin', \r\n                `<iframe\r\n                    class=\"authorizationIframe\"\r\n                    style=\"display: block !important; position: absolute; left: -99999px;\"\r\n                    src=\"${this._userInfoEndpoint}/?client_id=1&redirect_uri=${this._redirectEndpointHtml}&scope=${scope}&state=${state}\">\r\n                </iframe>`);\r\n\r\n            })\r\n            .catch(() => {\r\n                reject({\r\n                    Status: 'error'\r\n                });\r\n            });\r\n\r\n        });               \r\n    }\r\n    /** Принудительное перелогинивание пользователя.\r\n     * Пользователь должен увидеть поля для ввода\r\n     * логина/пароля (возможно, на сервере авторизации).\r\n     * При успешной авторизации библиотека должна\r\n     * произвести авторизацию пользователя на всех\r\n     * подключенных серверах ресурсов\r\n     * и только после этого resolve promise\r\n     * @return {Function} promise(userInfo)\r\n     */\r\n    login (arg) {\r\n        let foreignServer;\r\n        let iframeContainer;\r\n        if (typeof arg === 'string') {\r\n            // обратная совместимость\r\n            foreignServer = arg;\r\n        } else if (typeof arg === 'object') {\r\n            foreignServer = arg.foreignServer;\r\n            iframeContainer = arg.iframeContainer;\r\n        }\r\n        \r\n        this._authorizeResourceServers()\r\n        .then(servers => {\r\n            // .. формируем параметры state и scope\r\n            let scope = '';\r\n            let state = '';\r\n            for (let i = 0; i < servers.length; i++) {\r\n                let response = servers[i];\r\n                scope += response.Service.ServerId + ',';\r\n                state += response.Result.State + ',';\r\n            }\r\n            scope = scope.slice(0, -1);\r\n            state = state.slice(0, -1);\r\n\r\n            let authUrl = `${this._authorizationEndpoint}/?client_id=1&redirect_uri=${this._redirectEndpointAshx2}&scope=${scope}&state=${state}`;\r\n\r\n            if (foreignServer) {\r\n                authUrl += `&authserver=${foreignServer}`;\r\n            }\r\n\r\n            if (!iframeContainer) {\r\n                window.open(authUrl, '_self');\r\n            } else {\r\n                window.authorizationGrant = authorizationGrant;\r\n                document.body.removeChild(document.body.querySelector('.authorizationIframe'));\r\n                document.body.insertAdjacentHTML('afterbegin', \r\n                `<iframe\r\n                    class=\"authorizationIframe\"\r\n                    src=\"${self._authorizationEndpoint}/?client_id=1\r\n                        &redirect_uri=${self._redirectEndpointHtml}\r\n                        &redirect_uri_alt=${self._redirectEndpointAshx2}\r\n                        &scope=${scope}\r\n                        &state=${state}\">\r\n                </iframe>`);\r\n\r\n                function authorizationGrant() {\r\n                    window.location.reload();                    \r\n                    let event = document.createEvent('Event');\r\n                    event.initEvent('login', false, false);\r\n                    this.dispatchEvent(event);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    /** Залогиниться, используя логин и пароль\r\n     * @param  {String} login\r\n     * @param  {String} password\r\n     * @return {Promise}\r\n     */\r\n    loginWithCredentials (login, password) {\r\n        // отправляем ajax-запрос на Handler/Login с логином и паролем\r\n        // После этого пользователь считается залогиненным на my.\r\n        // Затем вызываем getUserInfo()\r\n\r\n        return new Promise ((resolve, reject) => {            \r\n            sendCrossDomainJSONRequest(\r\n                `${this._credentialLoginEndpoint}?login=${encodeURIComponent(login)}&password=${encodeURIComponent(password)}`,\r\n                response => {\r\n                    if (response.Status.toLowerCase() === 'ok') {\r\n                        this.getUserInfo()\r\n                        .then(() => {\r\n                            resolve({\r\n                                Status: 'ok',\r\n                                Result: arguments[0].Result\r\n                            });\r\n                        })\r\n                        .catch(() => {\r\n                            reject({\r\n                                Status: 'error',\r\n                                Result: {\r\n                                    Message: 'authorization error'\r\n                                }\r\n                            });\r\n                        });\r\n                    } else if (response.Status.toLowerCase() === 'auth') {\r\n                        reject({\r\n                            Status: 'auth',\r\n                            Result: {\r\n                                Message: response.Result.Message\r\n                            }\r\n                        });\r\n                    } else {\r\n                        reject({\r\n                            Status: 'error',\r\n                            Result: {\r\n                                Message: 'unknown error'\r\n                            }\r\n                        });\r\n                    }\r\n                },\r\n                'CallbackName',\r\n                () => {\r\n                    reject({\r\n                        Status: 'network',\r\n                        Result: {\r\n                            Message: 'network error'\r\n                        }\r\n                    });\r\n                }\r\n            );\r\n        });        \r\n    }\r\n    /** Принудительное разлогинивание пользователя.\r\n     * В том числе и на серверах ресурсов\r\n     * @return {Function} promise(status)\r\n     */\r\n    logout () {\r\n        return new Promise ((resolve, reject) => {\r\n            let promises = [];\r\n            for (let i = 0; i < this._resourceServers.length; i++) {\r\n                let resourceServer = this._resourceServers[i];\r\n                let promise = resourceServer.sendGetRequest('oAuth2/Logout.ashx');\r\n                promises.push(promise);\r\n            }\r\n            this._chain(promises, {})\r\n            .then(() => {\r\n                if (this._clientId === 1) {\r\n                    sendCrossDomainJSONRequest('//my.kosmosnimki.ru/Handler/Logout',\r\n                    (response) => resolve({ Status: 'ok'}), '', () => reject({ Status: 'network'}));\r\n                } else {\r\n                    resolve({\r\n                        Status: 'ok'\r\n                    });                    \r\n                    let event = document.createEvent('Event');\r\n                    event.initEvent('logout', false, false);\r\n                    this.dispatchEvent(event);\r\n                }\r\n            })\r\n            .catch(() => {\r\n                reject({\r\n                    Status: 'error'\r\n                });\r\n            });            \r\n        });           \r\n    }\r\n}\r\n\r\nexport default AuthManager;\r\n","const copy = source => {\r\n    switch(typeof source) {\r\n        case 'number':\r\n        case 'string':\r\n        case 'function':\r\n        default:\r\n            return source;\r\n        case 'object':\r\n            if (source === null) {\r\n                return null;\r\n            }\r\n            else if (Array.isArray(source)) {\r\n                return source.map (item => copy (item));\r\n            }\r\n            else if (source instanceof Date) {\r\n                return source;\r\n            }\r\n            else {                \r\n                return Object.keys(source).reduce((a, k) => {                    \r\n                    a[k] = copy(source[k]);\r\n                    return a;\r\n                }, {});\r\n            }\r\n    }\r\n};\r\n\r\nconst extend = (target, source) => {\r\n    if (target === source) {\r\n\t    return target;\r\n    }\r\n    else {\r\n        return Object.keys(source).reduce((a, k) => {\r\n            let value = source[k];\r\n            if(typeof a[k] === 'object' && (k in a)){\r\n                a[k] = extend (a[k], value);\r\n            }\r\n            else {\r\n               a[k] = copy(value);\r\n            }\r\n            return a;\r\n        }, copy (target));\r\n    }    \r\n};\r\n\r\n\r\nexport {copy, extend};","import './DropdownWidget.css';\r\nimport EventTarget from 'scanex-event-target';\r\nimport { extend } from 'scanex-object-extensions';\r\n\r\n// <String>options.title\r\n// <String>options.className\r\n// <String>options.trigger (hover|click|manual)\r\n// <String>options.direction (down|up)\r\n// <Boolean>options.adjustWidth\r\n// <Boolean>options.showTopItem\r\nclass DropdownWidget extends EventTarget {\r\n    constructor (options){\r\n        super();\r\n        this.options = extend({\r\n            title: '',\r\n            trigger: 'hover',\r\n            direction: 'down',\r\n            adjustWidth: true,\r\n            showTopItem: true,\r\n            titleClassName: ''\r\n        }, options);\r\n\r\n        this.$el = this.options.el;\r\n        this.$el.classList.add ('dropdownWidget');\r\n        this.$el.classList.add ('dropdownWidget-item');        \r\n\r\n        this.$titleContainer = document.createElement('div');\r\n        this.$titleContainer.classList.add('dropdownWidget-dropdownTitle');\r\n        if (this.options.titleClassName) {\r\n            this.$titleContainer.classList.add(this.options.titleClassName);\r\n        }        \r\n        this.$titleContainer.innerHTML = this.options.title;\r\n        this.$el.appendChild(this.$titleContainer);\r\n        \r\n        this.$dropdownContainer = document.createElement('div');\r\n        this.$dropdownContainer.classList.add('dropdownWidget-dropdown');\r\n        this.$dropdownContainer.style.display = 'none';\r\n        this.$el.appendChild(this.$dropdownContainer);\r\n\r\n        this.$dropdownTitle = document.createElement('div');        \r\n        this.$dropdownTitle.classList.add('dropdownWidget-item');\r\n        this.$dropdownTitle.classList.add('dropdownWidget-dropdownTitle');\r\n        if(options.titleClassName) {\r\n            this.$dropdownTitle.classList.add(options.titleClassName);\r\n        }        \r\n        this.$dropdownTitle.innerHTML = this.options.title;\r\n        this.$dropdownContainer.appendChild(this.$dropdownTitle);            \r\n\r\n        if (!this.options.showTopItem) {\r\n            this.$dropdownTitle.style.display = 'none';\r\n        }\r\n\r\n        if (this.options.trigger === 'hover') {\r\n            this.$dropdownTitle.classList.add('ui-state-disabled');\r\n            this.$titleContainer.addEventListener('mouseover', () => this.expand());\r\n            this.$dropdownContainer.addEventListener('mouseleave', () => this.collapse());\r\n        } else if (this.options.trigger === 'click') {\r\n            this.$titleContainer.addEventListener('click', () => this.expand());\r\n            this.$dropdownTitle.addEventListener('click', () => this.collapse());\r\n        }\r\n\r\n        if (this.options.direction === 'up') {\r\n            this.$el.classList.add('dropdownWidget_direction-up');\r\n        } else {\r\n            this.$el.classList.add('dropdownWidget_direction-down');\r\n        }\r\n\r\n        this._items = {};\r\n    }\r\n    addItem (id, inst, position) {\r\n        this._items[id] = inst;\r\n\r\n        let $container = document.createElement('div');\r\n        \r\n        $container.classList.add('dropdownWidget-item');\r\n        $container.classList.add('dropdownWidget-dropdownItem');\r\n        $container.setAttribute('data-id', id);            \r\n        $container.setAttribute('data-position', position);\r\n        $container.addEventListener('click', je => {            \r\n            let event = document.createEvent('Event');\r\n            event.initEvent('item:click', false, false);\r\n            event.detail = { dataId: je.currentTarget.getAttribute('data-id') };\r\n            this.dispatchEvent(event);\r\n            \r\n            if (this.options.trigger === 'click') {\r\n                this.collapse();\r\n            }            \r\n        });\r\n        $container.appendChild(inst.el);\r\n        this.$dropdownContainer.appendChild($container);\r\n        this._sortItems()\r\n    }\r\n\r\n    setTitle (title) {\r\n        this.$titleContainer.innerHTML = title;\r\n        this.$dropdownTitle.innerHTML = title;\r\n    }\r\n\r\n    toggle () {\r\n        this._expanded ? this.collapse() : this.expand();\r\n        this._expanded = !this._expanded;\r\n    }\r\n\r\n    expand () {\r\n        const r = this.$el.getBoundingClientRect();\r\n        this.$dropdownContainer.style.minWidth = `${r.width}px`;\r\n        this.$dropdownContainer.style.display = 'block';\r\n        let event = document.createEvent('Event');\r\n        event.initEvent('expand', false, false);\r\n        event.detail = {};\r\n        this.dispatchEvent(event);\r\n    }\r\n\r\n    collapse () {\r\n        this.$dropdownContainer.style.display = 'none';\r\n        let event = document.createEvent('Event');\r\n        event.initEvent('collapse', false, false);\r\n        event.detail = {};\r\n        this.dispatchEvent(event);\r\n    }\r\n\r\n    reset () {\r\n        this.collapse();\r\n    }\r\n\r\n    _sortItems () {\r\n        let containerEl = this.$dropdownContainer[0];\r\n        let items = Array.prototype.slice.call(containerEl.children);\r\n\r\n        let titleEl = items.splice(\r\n            items.indexOf(containerEl.querySelector('.dropdownWidget-dropdownTitle')), 1\r\n        );\r\n\r\n        while (items.length) {            \r\n            let positions = items.map(el => parseInt (el.getAttribute('data-position'), 10));\r\n            let maxPositionIndex = positions.indexOf(Math.max.apply(null, positions));\r\n            containerEl.insertBefore(items.splice(maxPositionIndex, 1)[0], containerEl.children[0]);\r\n        }\r\n\r\n        if (this.options.direction === 'up') {\r\n            containerEl.appendChild(titleEl);\r\n        } else {\r\n            containerEl.insertBefore(titleEl, containerEl.children[0]);\r\n        }\r\n    }\r\n}\r\n\r\nexport default DropdownWidget;","import './DropdownMenuWidget.css';\r\n\r\nclass DropdownMenuWidget {\r\n    constructor(options) {\r\n\r\n        this._view = document.createElement('div');\r\n        this._view.classList.add('dropdownMenuWidget');        \r\n        this._view.innerHTML = options.items.map(this._renderItem.bind(this)).join('');\r\n        let dropDown = this._view.querySelector('.dropdownMenuWidget-itemDropdown');\r\n        if(dropDown) {\r\n            dropDown.style.display = 'none';\r\n        }\r\n        let mouseTimeout = options.mouseTimeout || 100;\r\n        let items = this._view.querySelectorAll('.dropdownMenuWidget-item');\r\n        for (let i = 0; i < items.length; ++i){\r\n            let mouseIsOver = false;\r\n            items[i].addEventListener('mouseenter', je => {\r\n                mouseIsOver = true;\r\n                setTimeout(() => {\r\n                    if (mouseIsOver) {\r\n                        let dd = je.target.querySelector('.dropdownMenuWidget-itemDropdown');\r\n                        if(dd) {\r\n                            dd.style.display = 'block';\r\n                        }\r\n                        \r\n                    }\r\n                }, 100);\r\n            });\r\n            items[i].addEventListener('mouseleave', je => {\r\n                mouseIsOver = false;\r\n                let dd = je.target.querySelector('.dropdownMenuWidget-itemDropdown');\r\n                if(dd) {\r\n                    dd.style.display = 'none';\r\n                }                \r\n            });\r\n        }\r\n    }\r\n    _renderDropdown ({className, id, link, newWindow, icon, title}) {\r\n        return `<li class=\"dropdownMenuWidget-dropdownMenuItem${ className ? (' ' + className) : ''}\">\r\n            ${ newWindow ? '<div class=\"ui-icon ui-icon-newwin dropdownMenuWidget-dropdownMenuIcon\"></div>' : ''}\r\n            <a\r\n                ${ id ? 'id=\"' + id + '\"' : ''}\r\n                ${ link ? 'href=\"' + link + '\"' : 'href=\"javascript:void(0)\"'}\r\n                ${ newWindow && link ? 'target=\"_blank\"' : ''}\r\n                class=\"dropdownMenuWidget-dropdownItemAnchor${ newWindow ? ' dropdownMenuWidget-dropdownItemAnchor_newWindow' : ''}\"\r\n            >\r\n                ${ icon ? '<img src=\"' + icon + '\"/>' : ''}\r\n                ${ title ? '<span>' + title + '</span>' : ''}\r\n            </a>\r\n        </li>`;\r\n    }\r\n    _renderItem({className, id, link, newWindow, icon, fonticon, title, dropdown}) {\r\n        return `<div class=\"dropdownMenuWidget-item${className ? ' ' + className : ''}\">\r\n        <a\r\n            ${ id ? 'id=\"' + id + '\"' : ''}\r\n            ${ link ? 'href=\"' + link + '\"' : 'href=\"javascript:void(0)\"'}\r\n            ${ newWindow && link ? 'target=\"_blank\"': ''}\r\n            class=\"dropdownMenuWidget-itemAnchor${ newWindow ? ' dropdownMenuWidget-itemAnchor_newWindow': ''}\"\r\n        >\r\n            ${ icon ? '<img src=\"' + icon + '\" />' : ''}\r\n            ${ fonticon ? '<i class=\"' + fonticon + '\"></i>' : ''}\r\n            ${ title ? '<span>' + title + '</span>' + (dropdown ? '<i class=\"icon-angle-down\"></i>' : '') : ''}\r\n        </a>\r\n        ${dropdown ? \r\n            '<div class=\"dropdownMenuWidget-itemDropdown\">\\\r\n                <ul class=\"dropdownMenuWidget-dropdownMenu\">' + dropdown.map(this._renderDropdown.bind(this)).join('') + '</ul>\\\r\n            </div>'\r\n            : ''}\r\n        </div>`;\r\n    }\r\n    appendTo (placeholder) {\r\n        placeholder.appendChild(this._view);\r\n    }\r\n}\r\n\r\nexport default DropdownMenuWidget;","import { extend } from 'scanex-object-extensions';\r\n\r\nconst DEFAULT_LANGUAGE = 'rus';\r\n\r\nclass Translations {\r\n    constructor(){\r\n        this._hash = {};\r\n    }    \r\n    setLanguage (lang) {\r\n        this._language = lang;\r\n    }\r\n    getLanguage () {\r\n        return window.language || this._language || DEFAULT_LANGUAGE;\r\n    }\r\n    addText (lang, tran) {        \r\n        this._hash[lang]= extend(this._hash[lang] || {}, tran);\r\n        return this;\r\n    }\r\n    getText (key) {\r\n        if(key && typeof key === 'string') {\r\n            let locale = this._hash[this.getLanguage()];\r\n            if (locale) {\r\n                return key\r\n                    .split('.')\r\n                    .reduce((a, k) => a[k], locale);\r\n            }         \r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nwindow.Scanex = window.Scanex || {};\r\nwindow.Scanex.Translations = window.Scanex.Translations || {};\r\nwindow.Scanex.translations = window.Scanex.translations || new Translations();\r\n\r\nexport default window.Scanex.translations;","import 'scanex-dropdown-widget/dist/scanex-dropdown-widget.css';\r\nimport { MenuWidget } from 'scanex-dropdown-widget';\r\n\r\nimport EventTarget from 'scanex-event-target';\r\nimport Translations from 'scanex-translations';\r\nimport '../assets/account.css';\r\nimport './AuthWidget.css';\r\n\r\nconst T = Translations;\r\n\r\nT.addText('rus', {\r\n\tauth: {\r\n\t\t'login': 'Войти',\r\n\t\t'logout': 'Выйти',\r\n\t\t'myAccount': 'Личный кабинет',\r\n\t\t'myMap': 'Личная карта',\r\n\t\t'closeDialog': 'Закрыть'\r\n\t}\r\n});\r\n\r\nT.addText('eng', {\r\n\tauth: {\r\n\t\t'login': 'Login',\r\n\t\t'logout': 'Logout',\r\n\t\t'myAccount': 'My account',\r\n\t\t'myMap': 'My map',\r\n\t\t'closeDialog': 'Close'\r\n\t}\r\n});\r\n\r\nclass AuthWidget extends EventTarget {\r\n    constructor(options) {\r\n        super();\r\n        this._view = document.createElement('div');\r\n        this._view.classList.add('authWidget');\r\n\r\n        this._authManager = options.authManager;\r\n        this._userInfo = null;\r\n        \r\n        this._options = options;\r\n        this._options.showAccountLink = true;\r\n        this._options.accountLink = `//my.kosmosnimki.ru/Home/Settings/`;\r\n        this._options.showMapLink = true;\r\n\r\n        this._authManager.getUserInfo()\r\n        .then(response => {\r\n            this._render({\r\n                login: response.Result && response.Result.Login,\r\n                userName: response.Result && (response.Result.FullName || response.Result.Nickname || response.Result.Login),\r\n                nickName: response.Result.Nickname,\r\n            });\r\n            this._userInfo = response.Result;            \r\n            let event = document.createEvent('Event');\r\n            event.initEvent('ready', false, false);\r\n            this.dispatchEvent(event);\r\n        })\r\n        .catch((response) => {\r\n            this._render(response);\r\n        });\r\n        this._authManager.addEventListener('login', () => {            \r\n            let event = document.createEvent('Event');\r\n            event.initEvent('login', false, false);\r\n            this.dispatchEvent(event);\r\n        });\r\n    }\r\n    _render (vm) {\r\n        this._view.innerHTML = vm.nickName ?\r\n            `<div class=\"authWidget_authorized\">\r\n                <div class=\"authWidget-userPanel\">\r\n                    <div class=\"authWidget-userPanel-iconCell\">\r\n                        <div class=\"authWidget-userPanel-userIcon account account-user-logout\"></div>\r\n                    </div>\r\n                    <div class=\"authWidget-userPanel-userMenuCell\"></div>\r\n                </div>\r\n            </div>` : \r\n            `<div class=\"authWidget_unauthorized\">\r\n                <!-- div class=\"authWidget-loginButton\">${T.getText('auth.login')}</div -->\r\n                <div class=\"authWidget-loginButton account account-user-login\"></div>\r\n            </div>`;        \r\n\r\n        if (vm.nickName) {\r\n            var dropdownItems = [];\r\n\r\n            if (this._options.showAccountLink) {\r\n                dropdownItems.push({\r\n                    title: T.getText('auth.myAccount'),\r\n                    link: this._options.accountLink,\r\n                    id: 'AuthWidgetAccountLink',\r\n                    newWindow: true,\r\n                    iconClass: 'account account-personal-area',\r\n                });\r\n            }\r\n\r\n            if (this._options.showMapLink) {\r\n                let defaultMapLink = `//maps.kosmosnimki.ru/api/index.html?${encodeURIComponent('@' + vm.login)}`;\r\n                dropdownItems.push({\r\n                    title: T.getText('auth.myMap'),\r\n                    link: this._options.mapLink || defaultMapLink,\r\n                    id: 'AuthWidgetMapLink',\r\n                    newWindow: true,\r\n                    iconClass: 'account account-personal-map',\r\n                });\r\n            }\r\n\r\n            dropdownItems.push({\r\n                title: T.getText('auth.logout'),\r\n                className: 'authWidget-logoutButton',\r\n                iconClass: 'account account-exit',\r\n            });\r\n\r\n            var dropdownMenuWidget = new MenuWidget({\r\n                items: [{\r\n                    title: vm.nickName,\r\n                    dropdown: dropdownItems\r\n                }]\r\n            });\r\n\r\n            dropdownMenuWidget.appendTo(this._view.querySelector('.authWidget-userPanel-userMenuCell'));\r\n        }\r\n\r\n\r\n        let loginBtn = this._view.querySelector('.authWidget-loginButton');\r\n        if (loginBtn) {\r\n            loginBtn.addEventListener('click', e => {\r\n                var $iframeContainer;\r\n                // if (this._options.loginDialog) {\r\n\r\n                //     $iframeContainer = document.createElement('div');\r\n                //     $iframeContainer.classList.add('authWidget-iframeContainer');\r\n                //     var dialog = $iframeContainer.dialog({\r\n                //         width: 500,\r\n                //         height: 450,\r\n                //         closeText: T.getText('auth.closeDialog'),\r\n                //         close: (je, ui) => {\r\n                //             $(this).dialog('destroy');\r\n                //         }\r\n                //     });\r\n                //     // HACK:\r\n                //     let btn = $iframeContainer.querySelector('button.ui-button');\r\n                //     if (btn) {\r\n                //         btn.classList.add('ui-icon');\r\n                //         btn.style.outline = 'none';\r\n                //     }                                \r\n                // }\r\n\r\n                this._authManager.login({\r\n                    iframeContainer: $iframeContainer && $iframeContainer[0]\r\n                });\r\n            });\r\n        }\r\n        \r\n\r\n        let logoutBtn = this._view.querySelector('.authWidget-logoutButton');\r\n        if(logoutBtn) {\r\n            logoutBtn.addEventListener('click', e => {\r\n                this._authManager.logout()\r\n                .then(response => {\r\n                    this._render(response);\r\n                    this._userInfo = response.Result;                    \r\n                    let event = document.createEvent('Event');\r\n                    event.initEvent('logout', false, false);\r\n                    this.dispatchEvent(event);\r\n                });\r\n            });\r\n        }        \r\n    }\r\n\r\n    /** Получить информацию о пользователе, которую вернул AuthManager\r\n     * @return {Object}\r\n     */\r\n    getUserInfo () {\r\n        return this._userInfo;\r\n    }\r\n\r\n    appendTo (placeholder) {\r\n        placeholder.appendChild(this._view);\r\n    }\r\n}\r\n\r\nexport default AuthWidget;","import { sendCrossDomainJSONRequest } from 'scanex-jsonp-request';\r\n\r\n//TODO: использовать ли библиотеку?\r\nfunction parseUri(str)\r\n{\r\n    var parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,\r\n        key = [\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"],\r\n        m = parser.exec(str),\r\n        uri = {},\r\n        i   = 14;\r\n\r\n    while (i--) uri[key[i]] = m[i] || \"\";\r\n    \r\n    // HACK\r\n    uri.hostOnly = uri.host;\r\n    uri.host = uri.authority;\r\n    \r\n    return uri;\r\n}\r\n\r\nlet requests = {};\r\nlet lastRequestId = 0;\r\nlet uniquePrefix = `id${Math.random()}`;\r\n\r\nfunction processMessage (e) {\r\n    if (e.origin in requests) {\r\n        let dataStr = decodeURIComponent(e.data.replace(/\\n/g,'\\n\\\\'));\r\n        try {\r\n            let dataObj = JSON.parse(dataStr);\r\n            var request = requests[e.origin][dataObj.CallbackName];\r\n            if (request) {\r\n                delete requests[e.origin][dataObj.CallbackName];\r\n                request.iframe.parentNode.removeChild(request.iframe);\r\n                request.callback && request.callback(dataObj);\r\n            }\r\n        }\r\n        catch (e) { }\r\n    }    \r\n}\r\n\r\n//совместимость с IE8\r\nif (window.addEventListener) {\r\n    window.addEventListener('message', processMessage);\r\n} else {\r\n    window.attachEvent('onmessage', processMessage);\r\n}\r\n\r\nfunction addQueryVariables (url, variables) {\r\n    let oldQueryString = url.split('?')[1];\r\n    let newQueryString = '';\r\n    for (let variable in variables) {\r\n        if (variables.hasOwnProperty(variable)) {\r\n            newQueryString += ('&' + variable + '=' + encodeURIComponent(variables[variable]));\r\n        }\r\n    }\r\n    if (oldQueryString) {\r\n        return url + newQueryString;\r\n    } else {\r\n        return url + '?' + newQueryString.slice(1);\r\n    }\r\n}\r\n\r\nfunction createPostIframe(id)\r\n{\r\n    var iframe = document.createElement(\"iframe\");\r\n    iframe.style.display = 'none';\r\n    iframe.setAttribute('id', id);\r\n    iframe.setAttribute('name', id);\r\n    iframe.src = 'javascript:true';\r\n    \r\n    return iframe;\r\n}\r\n\r\nclass Server {\r\n    constructor({root}) {\r\n        this._root = root;\r\n    }\r\n\r\n    /** Послать GET запрос к серверу ресурсов.\r\n     * @param  {String} url\r\n     * @param  {Object} params\r\n     * @return {Function} promise(data)\r\n     */\r\n    sendGetRequest (url, params) {\r\n        return new Promise((resolve, reject) => {\r\n            let requestUrl = `${this._root}/${url}`;\r\n            requestUrl = addQueryVariables(requestUrl, params);\r\n            sendCrossDomainJSONRequest(requestUrl, data => resolve(data), 'CallbackName', errors => reject({ Status: 'error' }));           \r\n        });        \r\n    }\r\n        \r\n    /** Послать к серверу ресурсов запрос за картинкой.\r\n     * @param  {String} url\r\n     * @param  {Object} params\r\n     * @return {Function} promise(image)\r\n     */\r\n    sendImageRequest (url, params) {            \r\n        let requestUrl = `${this._root}/${url}`;\r\n        requestUrl = addQueryVariables(requestUrl, params);\r\n        \r\n        var img = new Image();\r\n        \r\n        img.onload = () => resolve({ Status: 'ok', Result: img });\r\n        img.onerror = errors => reject(errors);            \r\n        img.src = requestUrl;\r\n    }\r\n\r\n    /** Послать POST запрос к серверу ресурсов.\r\n     * @param  {String} url\r\n     * @param  {Object} params\r\n     * @param  {HTMLFormElement} baseForm HTML Form, которая может быть использована как основа для посылки запроса (например, если нужно загрузить файл)\r\n     * @return {Function} promise(data)\r\n     */\r\n    sendPostRequest (url, params, baseForm) {\r\n        let requestURL = `${this._root}/${url}`;            \r\n        return new Promise((resolve, reject) => {\r\n            let processResponse = (response) => {\r\n                if (response.Status !== 'ok') {\r\n                    reject(response);\r\n                } else {\r\n                    resolve(response);\r\n                }\r\n            };\r\n\r\n            try {\r\n                \r\n                let id = `${uniquePrefix}${lastRequestId++}`;\r\n                let iframe = createPostIframe(id);\r\n                let parsedURL = parseUri(requestURL);\r\n                let origin = (parsedURL.protocol ? `${parsedURL.protocol}:` : window.location.protocol) + `//${parsedURL.host || window.location.host}`;\r\n                let originalFormAction;\r\n                let form;\r\n                \r\n                requests[origin] = requests[origin] || {};\r\n                requests[origin][id] = {callback: processResponse, iframe: iframe};\r\n                    \r\n                if (baseForm)\r\n                {\r\n                    form = baseForm;\r\n                    originalFormAction = form.getAttribute('action');\r\n                    form.setAttribute('action', requestURL);\r\n                    form.target = id;                \r\n                }\r\n                else\r\n                {\r\n                    form = document.createElement('form');\r\n                    form.style.display = 'none';\r\n                    form.setAttribute('enctype', 'multipart/form-data');\r\n                    form.target = id;\r\n                    form.setAttribute('method', 'POST');\r\n                    form.setAttribute('action', requestURL);\r\n                    form.id = id;\r\n                }\r\n                \r\n                let hiddenParamsDiv = document.createElement(\"div\");\r\n                hiddenParamsDiv.style.display = 'none';\r\n                \r\n                let appendFormParam = function(paramName, paramValue) { \r\n                    let input = document.createElement(\"input\");            \r\n                    paramValue = typeof paramValue !== 'undefined' ? paramValue : '';\r\n                    \r\n                    input.setAttribute('type', 'hidden');\r\n                    input.setAttribute('name', paramName);\r\n                    input.setAttribute('value', paramValue);\r\n                    \r\n                    hiddenParamsDiv.appendChild(input)\r\n                }\r\n                \r\n                for (let paramName in params) {\r\n                    appendFormParam(paramName, params[paramName]);\r\n                }\r\n                \r\n                appendFormParam('WrapStyle', 'message');\r\n                appendFormParam('CallbackName', id);\r\n                \r\n                form.appendChild(hiddenParamsDiv);\r\n                \r\n                if (!baseForm)\r\n                    document.body.appendChild(form);\r\n                    \r\n                document.body.appendChild(iframe);\r\n                \r\n                form.submit();\r\n                \r\n                if (baseForm)\r\n                {\r\n                    form.removeChild(hiddenParamsDiv);\r\n                    if (originalFormAction !== null)\r\n                        form.setAttribute('action', originalFormAction);\r\n                    else\r\n                        form.removeAttribute('action');\r\n                }\r\n                else\r\n                {\r\n                    form.parentNode.removeChild(form);\r\n                }\r\n            }\r\n            catch (e) {\r\n                reject(e);\r\n            }\r\n            \r\n        });                                    \r\n    }\r\n}\r\n\r\nexport default Server;","import Server from './Server.js';\r\n\r\nclass ResourceServer extends Server {\r\n    constructor(authManager, {id, root}){\r\n        super({root});\r\n        this._id = id;        \r\n        this._authManager = authManager;\r\n        this._authManager.$addResourceServer(this);     \r\n    }    \r\n    sendGetRequest (url, params, baseForm) {\r\n        params = params || {};\r\n        params.sync = this._authManager.$getAntiCsrfToken();\r\n        return new Promise ((resolve, reject) => {\r\n            super.sendGetRequest(url, params, baseForm)\r\n            .then(data => {\r\n                data.Service = { ServerId: this._id };            \r\n                if (data.Status === 'ok') {\r\n                    resolve(data);\r\n                } else {\r\n                    reject(data);\r\n                }\r\n            })\r\n            .catch(errors => reject({ Status: 'error', ErrorInfo: errors.ErrorInfo }));\r\n        });  \r\n    }\r\n    sendImageRequest (url, params, baseForm) {\r\n        params = params || {};\r\n        params.sync = this._authManager.$getAntiCsrfToken();\r\n        return new Promise ((resolve, reject) => {\r\n            super.sendImageRequest(url, params, baseForm)\r\n            .then(data => {\r\n                data.Service = { ServerId: this._id };            \r\n                if (data.Status === 'ok') {\r\n                    resolve(data);\r\n                } else {\r\n                    reject(data);\r\n                }\r\n            })\r\n            .catch(errors => reject({ Status: 'error', ErrorInfo: errors.ErrorInfo }));\r\n        });  \r\n    }\r\n    sendPostRequest (url, params, baseForm) {\r\n        params = params || {};\r\n        params.sync = this._authManager.$getAntiCsrfToken();\r\n        return new Promise ((resolve, reject) => {\r\n            super.sendPostRequest(url, params, baseForm)\r\n            .then(data => {\r\n                data.Service = { ServerId: this._id };            \r\n                if (data.Status === 'ok') {\r\n                    resolve(data);\r\n                } else {\r\n                    reject(data);\r\n                }\r\n            })\r\n            .catch(errors => reject({ Status: 'error', ErrorInfo: errors.ErrorInfo }));\r\n        });  \r\n    }\r\n}\r\n\r\nexport default ResourceServer;","import ResourceServer from './ResourceServer.js';\r\nimport AuthManager from './AuthManager.js';\r\n\r\nlet resourceServersInstances = {};\r\nlet resourceServersConstructors = {};\r\nlet authManager;\r\n\r\n// строка, в которой перечислены псевдонимы используемых нами серверов ресурсов.\r\n// потребуется для синхронизации серверов ресурсов\r\nlet scope;\r\n\r\n// зашиваем известные и часто-используемые ресурсы\r\nresourceServersConstructors['subscriptions'] = () => {\r\n    return new ResourceServer(authManager, {\r\n        id: 'subscriptions',\r\n        root: '//fires.kosmosnimki.ru/SAPIv2'\r\n    });\r\n};\r\n\r\nresourceServersConstructors['geomixer2'] = () => {\r\n    return new ResourceServer(authManager, {\r\n        id: 'geomixer2',\r\n        root: '//maps2.kosmosnimki.ru'\r\n    });\r\n};\r\n\r\nresourceServersConstructors['geomixer'] = () => {\r\n    return new ResourceServer(authManager, {\r\n        id: 'geomixer',\r\n        root: '//maps.kosmosnimki.ru'\r\n    });\r\n};\r\n\r\nresourceServersConstructors['geocode'] = () => {\r\n    return new ResourceServer(authManager, {\r\n        id: 'geocode',\r\n        root: '//geocode.kosmosnimki.ru'\r\n    });\r\n};\r\n\r\nfunction getResourceServer (id) {\r\n    if (!authManager) {\r\n        authManager = getAuthManager();\r\n    }\r\n    // используем lazy instantiation для отложенного создания\r\n    // необходимых нам компонентов\r\n    if (!resourceServersInstances[id]) {\r\n        resourceServersInstances[id] = resourceServersConstructors[id]();\r\n        if (!scope) {\r\n            scope = id;\r\n        } else {\r\n            scope += (',' + id);\r\n        }\r\n    }\r\n    return resourceServersInstances[id];\r\n}\r\n\r\nfunction getAuthManager () {\r\n    // то же и с authManager\r\n    if (!authManager) {\r\n        authManager = new AuthManager({\r\n            authorizationEndpoint: '//my.kosmosnimki.ru/Test/LoginDialog',\r\n            userInfoEndpoint: '//my.kosmosnimki.ru/oAuth/LoginDialog',\r\n            redirectEndpointHtml: location.href.replace(/[^\\/]+$/, '') + 'oAuth2/oAuthCallback.htm',\r\n            redirectEndpointAshx: location.href.replace(/[^\\/]+$/, '') + 'oAuth2/oAuthCallback.ashx',\r\n            credentialLoginEndpoint: '//my.kosmosnimki.ru/Handler/Login'\r\n        });\r\n    }\r\n    return authManager;\r\n}\r\n\r\nexport { getAuthManager, getResourceServer };","const chain = (tasks, state) => {\r\n    return tasks.reduce(\r\n        (prev, next) => prev.then(next),\r\n        new Promise ((resolve, reject) => resolve (state))\r\n    );\r\n};\r\n\r\nexport { chain };","const isNumber = n => !isNaN (new Number(n));\r\n\r\nfunction chain (tasks, state) {\r\n    return tasks.reduce(\r\n        (prev, next) => prev.then(next),\r\n        new Promise ((resolve, reject) => resolve (state))\r\n    );\r\n}\r\n\r\nfunction create_container () {\r\n    let container = document.createElement('div');\r\n    document.body.appendChild(container);\r\n    return container;\r\n}\r\n\r\nfunction _f (arr, acc, swap) {\r\n    if (arr.length) {\r\n        let r = [];\r\n        for (let i = 0, len = arr.length; i < len; i++) {\r\n            let a = arr[i];\r\n            if (_f(a, acc, swap)) {\r\n                if (swap) {\r\n                    r.unshift(a);\r\n                }\r\n                else {\r\n                    r.push(a);\r\n                }\r\n            }\r\n        }\r\n        if (r.length) {\r\n            acc.push(r);\r\n        }\r\n        return false;\r\n    }\r\n    else {\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction flatten (arr, swap) {\r\n    let acc = [];\r\n    _f(arr, acc, swap);\r\n    return acc;\r\n}\r\n\r\nfunction split_complex_id (complexId) {\r\n    let separatorIndex = complexId.lastIndexOf('!');\r\n    return separatorIndex > 0\r\n        ? { id: complexId.substring(0, separatorIndex),\r\n            productId: complexId.substring(separatorIndex + 1, complexId.length)\r\n        }\r\n        : { id: complexId };\r\n}\r\n\r\nfunction build_complex_id (id, productId) {\r\n    return productId ? id + '!' + productId : id;\r\n}\r\n\r\nfunction hex (number, width = 6) {\r\n    let h = number.toString(16);\r\n    while (h.length < width) {\r\n        h = '0' + h;\r\n    }\r\n    return h.toUpperCase();\r\n}\r\n\r\nfunction unhex (str) {\r\n    return parseInt(str.substr(1), 16);\r\n}\r\n\r\nfunction is_geometry(obj) {\r\n    let {type} = obj;\r\n    switch (type) {\r\n        case 'Point':\r\n        case 'MultiPoint':\r\n        case 'LineString':\r\n        case 'MultiLineString':\r\n        case 'Polygon':\r\n        case 'MultiPolygon':\r\n        case 'GeometryCollection':\r\n            return true;\r\n        default:\r\n            return false;\r\n    }    \r\n}\r\n\r\nfunction normalize_geometry_type (geometry) {\r\n    let {type} = geometry;\r\n    switch (type.toUpperCase()) {\r\n        case 'POINT':\r\n            geometry.type = 'Point';\r\n            break;\r\n        case 'MULTIPOINT':\r\n            geometry.type = 'MultiPoint';\r\n            break;\r\n        case 'LINESTRING':\r\n            geometry.type = 'LineString';\r\n            break;\r\n        case 'MULTILINESTRING':\r\n            geometry.type = 'MultiLineString';\r\n            break;\r\n        case 'POLYGON':\r\n            geometry.type = 'Polygon';\r\n            break;\r\n        case 'MULTIPOLYGON':\r\n            geometry.type = 'MultiPolygon';\r\n            break;\r\n        case 'GEOMETRYCOLLECTION':\r\n            geometry.type = 'GeometryCollection';\r\n            break;\r\n        default:\r\n            break;\r\n    }  \r\n    return geometry;  \r\n}\r\n\r\nfunction is_geojson_feature (obj) {\r\n    let {type, geometry, properties} = obj;\r\n    if(type !== 'Feature') {\r\n        console.log('geojson feature test failed: provided type is not a \"Feature\" object', obj);\r\n        return false;\r\n    }\r\n    if(!is_geometry(geometry)) {\r\n        console.log('geojson feature test failed: geometry is of wrong type', geometry);\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction get_type_of_value (value) {\r\n    switch(typeof value) {\r\n        case 'number':                                \r\n            return Number.isInteger(value) ? 'Integer' : 'Float';\r\n        case 'boolean':                        \r\n            return 'Boolean';\r\n        case 'string':\r\n        default:\r\n            return 'String';\r\n    }\r\n}\r\n\r\nfunction convert_date (item, fields) {\r\n    for (let k in fields) {\r\n        let field = fields[k];\r\n        if (field.type === 'date') {\r\n            item[k] = new Date(item[k]);\r\n        }\r\n    }\r\n    return item;\r\n}\r\n\r\nfunction from_gmx ({fields, values, types}, convertMercator = true) {\r\n    return values.map(x => {\r\n        let item = fields.reduce((a, k, i) => {\r\n            switch(types[i]){\r\n                default:                    \r\n                    a[k] = x[i];\r\n                    break;                   \r\n                case 'date':\r\n                    switch (typeof x[i]) {\r\n                        case 'string':\r\n                            a[k] = new Date(x[i]);\r\n                            break;\r\n                        case 'number':\r\n                            a[k] = new Date(x[i] * 1000);\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }                    \r\n                    break;\r\n                case 'time':\r\n                    break;\r\n                case 'geometry':\r\n                    a[k] = L.gmxUtil.geometryToGeoJSON(x[i], convertMercator);\r\n                    break;\r\n            }\r\n            switch (k) {\r\n                case 'stereo':\r\n                    const s = x[i];\r\n                    a.stereo = typeof s === 'string' && s !== 'NONE';\r\n                    break;                    \r\n                default:\r\n                    break;\r\n            }\r\n            return a;                    \r\n        }, {});\r\n        if (item.geomixergeojson) {\r\n            item.geoJSON = item.geomixergeojson;\r\n            delete item.geomixergeojson;\r\n        }        \r\n        item.url = `//search.kosmosnimki.ru/QuickLookImage.ashx?id=${item.sceneid}`;\r\n        return item;\r\n    });    \r\n}\r\n\r\nfunction normalize_point (lng, [x,y]) {\r\n    return [make_close_to(lng, x),y];\r\n}\r\n\r\nfunction normalize_ring (lng, coordinates) {\r\n    return coordinates.map(normalize_point.bind(null, lng));\r\n}\r\n\r\nfunction normalize_polygon (lng, coordinates) {        \r\n    if (isNumber (lng)) {\r\n        return coordinates.map(normalize_ring.bind(null, lng));\r\n    }\r\n    else {\r\n        return coordinates.map(normalize_ring.bind(null, get_ref_lon(coordinates)));\r\n    }\r\n}\r\n\r\nfunction get_ref_lon (coordinates) {        \r\n    let f = flatten (coordinates);\r\n    let pos = f.filter(([x,y]) => x >= 0);\r\n    let [x,y] = pos.length > 0 ? pos[0] : f[0];        \r\n    return x;    \r\n}\r\n\r\nfunction normalize_geometry (geometry, lng) {\r\n    let {type, coordinates} = geometry;\r\n    const x = isNumber(lng) ? lng : get_ref_lon(coordinates);\r\n    switch (type.toUpperCase()) {\r\n        case 'POLYGON':\r\n            return {type, coordinates: normalize_polygon(x, coordinates)};\r\n        case 'MULTIPOLYGON':\r\n            return {type, coordinates: coordinates.map(normalize_polygon.bind(null, x))};\r\n        default:\r\n            return geometry;\r\n    }\r\n}\r\n\r\nfunction wrap_point ([x,y]) {\r\n    let lon = x;\r\n    while (lon < -180) {\r\n        lon += 360;\r\n    }\r\n    while (lon > 180) {\r\n        lon -= 360;\r\n    }\r\n    return [lon,y];\r\n}\r\n\r\nfunction wrap_ring (coordinates) {\r\n    return coordinates.map(wrap_point);\r\n}\r\n\r\nfunction wrap_polygon (coordinates) {\r\n    return coordinates.map(wrap_ring);\r\n}\r\n\r\nfunction wrap_geometry (geometry) {\r\n    let {type, coordinates} = geometry;\r\n    switch (type.toUpperCase()) {\r\n        case 'POLYGON':\r\n            return {type, coordinates: wrap_polygon(coordinates)};\r\n        case 'MULTIPOLYGON':\r\n            return {type, coordinates: coordinates.map(wrap_polygon)};\r\n        default:\r\n            return geometry;\r\n    }\r\n}\r\n\r\nfunction get_bbox (geometry) {\r\n    let {type, coordinates} = geometry;\r\n    let lon = 0, lat = 0;\r\n    let sorter = (a,b)=> {\r\n        if (a > b) {\r\n            return 1;\r\n        }\r\n        if (a < b) {\r\n            return -1;\r\n        }            \r\n        return 0;\r\n    };\r\n    let rings = coords => {\r\n        let {xs, ys} = coords.reduce((a, [x, y]) => {        \r\n            a.xs.push (x);\r\n            a.ys.push (y);\r\n            return a;\r\n        }, {xs:[],ys:[]});        \r\n        xs = xs.sort(sorter);\r\n        ys = ys.sort(sorter);\r\n        let xmin = xs[0];\r\n        let xmax = xs[xs.length - 1];\r\n        let ymin = ys[0];\r\n        let ymax = ys[ys.length - 1];\r\n        return [[xmin,ymax],[xmax,ymax],[xmax,ymin],[xmin,ymin]];\r\n    };\r\n    switch (type.toUpperCase()) {\r\n        case 'POINT':\r\n            [lon, lat] = coordinates;\r\n            return [[lon,lat],[lon,lat],[lon,lat],[lon,lat]];\r\n        case 'MULTIPOINT':\r\n        case 'LINESTRING':\r\n            return rings (coordinates);\r\n        case 'POLYGON':\r\n            return rings (coordinates[0]);\r\n        case 'MULTILINESTRING':\r\n        case 'MULTIPOLYGON':\r\n            let {xs, ys} = coordinates.reduce ((a, coords) => {\r\n                let [[x1,y1],[x2,y2],[x3,y3],[x4,y4]] = rings (coords[0]);\r\n                a.xs.push (x1);\r\n                a.xs.push (x2);\r\n                a.xs.push (x3);\r\n                a.xs.push (x4);\r\n                a.ys.push (y1);\r\n                a.ys.push (y2);\r\n                a.ys.push (y3);\r\n                a.ys.push (y4);\r\n                return a;\r\n            }, {xs: [], ys: []});\r\n            xs = xs.sort(sorter);\r\n            ys = ys.sort(sorter);\r\n            let xmin = xs[0];\r\n            let xmax = xs[xs.length - 1];\r\n            let ymin = ys[0];\r\n            let ymax = ys[ys.length - 1];\r\n            return [[xmin,ymax],[xmax,ymax],[xmax,ymin],[xmin,ymin]];                        \r\n        default:\r\n            return null;\r\n    }\r\n}\r\n\r\nconst EAST_HEMISPHERE = L.bounds(\r\n    L.point(0, -90), \r\n    L.point(180, 90)\r\n);\r\n\r\nconst WEST_HEMISPHERE = L.bounds(\r\n    L.point(180, -90),\r\n    L.point(360, 90)\r\n);\r\n\r\nconst WEST_HEMISPHERE2 = L.bounds(\r\n    L.point(-180, -90),\r\n    L.point(0, 90)\r\n);\r\n\r\nfunction split180 (geometry) {\r\n    const {type, coordinates} = geometry;\r\n    let split_coords = (points, hemisphere) => {        \r\n        let coords = L.PolyUtil.clipPolygon(points, hemisphere).map(({x,y}) => [x,y]);\r\n        if (coords.length > 0) {\r\n            let start_point = coords[0];\r\n            let end_point = coords[coords.length - 1];\r\n            if (start_point[0] != end_point[0] || start_point[1] != end_point[1]) {\r\n                coords.push(start_point);\r\n            }\r\n        }\r\n        return coords;\r\n    };    \r\n    let geometries = [];\r\n    switch(type.toUpperCase()) {\r\n        case 'POLYGON':\r\n            const points = coordinates[0].map(([x,y]) => L.point(x,y));\r\n            let c1 =  split_coords(points, EAST_HEMISPHERE);\r\n            if (c1.length > 0) {\r\n                geometries.push(normalize_geometry ({type, coordinates: [c1]}, 179));\r\n            }            \r\n            let c2 = split_coords(points, WEST_HEMISPHERE);\r\n            if (c2.length > 0) {\r\n                geometries.push(normalize_geometry ({type, coordinates: [c2]}, -179));\r\n            }\r\n            else {\r\n                c2 = split_coords(points, WEST_HEMISPHERE2);\r\n                if (c2.length > 0) {\r\n                    geometries.push(normalize_geometry ({type, coordinates: [c2]}, -179));\r\n                }\r\n            }\r\n            break;\r\n        case 'LINESTRING':            \r\n        default:\r\n            geometries.push(geometry);\r\n            break;\r\n    }\r\n    return geometries;\r\n}\r\n\r\nfunction make_close_to (lng, x) {\r\n    let dist = (a,b) => Math.abs (a - b);\r\n    let {p} = [x - 360, x, x + 360]\r\n    .map(p => {\r\n        return {p, d: dist (lng, p)};\r\n    })\r\n    .reduce((a,{p,d}) => {\r\n        if (a === null || d < a.d) {\r\n            a = {d, p};\r\n        }\r\n        return a;\r\n    }, null);\r\n    return p;\r\n}\r\n\r\nfunction get_window_center () {\r\n    let {left, top, width, height} = document.body.getBoundingClientRect();\r\n    return {left: left + Math.round (width / 2), top: top + Math.round(height / 2)};\r\n}\r\n\r\nfunction read_permalink (id) {\r\n    return new Promise((resolve, reject) => {        \r\n        if (window.Catalog.gmxResourceServer) {\r\n\r\n            window.Catalog.gmxResourceServer.sendGetRequest('TinyReference/Get.ashx', { id: id })\r\n            .then(response => {\r\n                if (response.Status == 'ok') {\r\n                    try {                    \r\n                        resolve(JSON.parse(response.Result));\r\n                    }\r\n                    catch (e) {\r\n                        reject(e);\r\n                    }\t\t\t\t        \r\n                }\r\n                else {\r\n                    reject(response.Result);\r\n                }\r\n            })\r\n            .catch(e => reject(e));\r\n        }\r\n        else {\r\n            reject(\"Geomixer resource server not defined.\");\r\n        }        \r\n    });\r\n}\r\n\r\nfunction is_mobile () {\r\n    var check = false;\r\n    (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);\r\n    return check;\r\n}\r\n\r\nexport {\r\n    chain, create_container, flatten, split_complex_id, unhex, hex, is_geojson_feature, is_geometry,\r\n    get_type_of_value, from_gmx, get_bbox, normalize_geometry_type,\r\n    normalize_geometry, normalize_polygon, normalize_ring, normalize_point, split180, make_close_to,\r\n    get_window_center, read_permalink, is_mobile\r\n};","import { getResourceServer } from 'scanex-auth';\r\nimport { chain } from 'scanex-async';\r\nimport { hex, from_gmx } from './app/Utils/Utils.js';\r\n\r\nwindow.LAYER_ID = '9B4733A8CBE942CE9F5E70DCAA6C1FBE'; // 'AFB4D363768E4C5FAC71C9B0C6F7B2F4'\r\n\r\nlet ss = ['WV03','WV02',\r\n'GE01','PHR','QB02',\r\n'KOMPSAT3A','KOMPSAT3',\r\n'IK','GF2',\r\n'KOMPSAT2',\r\n'SP6_7','BKA','GF1_2m','ZY3','RE',\r\n'LANDSAT_8',\r\n'GF1_16m',\r\n'WV01',\r\n'EROSB','EROSA',\r\n'GE01_L','IK_L','QB02_L','WV01_L','WV02_L',\r\n'SP5_2MS','SP5_5MS','SP5_10MS',\r\n'SP5_2PC','SP5_5PC'];\r\n\r\nlet gmxResourceServer = getResourceServer('geomixer');\r\n\r\nfunction read_permalink (state) {\r\n    return new Promise((resolve, reject) => {\r\n        gmxResourceServer.sendGetRequest('TinyReference/Get.ashx', { id: state.id })\r\n        .then(response => {\r\n            if (response.Status == 'ok') {\r\n                try {\r\n                    resolve(JSON.parse(response.Result));\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\t\t\t\t        \r\n            }\r\n            else {\r\n                reject(response.Result);\r\n            }\r\n        })\r\n        .catch(e => reject(e));\r\n    });\r\n}\r\n\r\nfunction get_query (ids) {\r\n    return ids.map(id => `(sceneid = '${id}')`).join (' OR ');\r\n}\r\n\r\nfunction search (ids) {\r\n    return new Promise((resolve, reject) => {        \r\n        if (ids.length > 0) {\r\n            gmxResourceServer.sendPostRequest('VectorLayer/Search.ashx', {\r\n                layer: LAYER_ID,\r\n                geometry: true,\r\n                pagesize: 0,\r\n                query: get_query(ids),\r\n                WrapStyle: 'message',\r\n            })\r\n            .then(response => {\r\n                if (response.Status == 'ok') {\r\n                    try {                        \r\n                        resolve(from_gmx(response.Result));\r\n                    }\r\n                    catch (e) {\r\n                        reject(e);\r\n                    }\t\t\t\t        \r\n                }\r\n                else {\r\n                    reject(response.Result);\r\n                }\r\n            })\r\n            .catch(e => reject(e));\r\n        }\r\n        else {            \r\n            resolve([]);\r\n        }\r\n    });\r\n}\r\n\r\nfunction get_items (state) {\r\n    return new Promise (resolve => {\r\n        search (state.selected.concat(state.quicklook))\r\n        .then (items => {\r\n            state.items = items;\r\n            state.items.forEach (item => {\r\n                item.quicklook = false;\r\n                if (Array.isArray(state.quicklook)) {\r\n                    for (let i = 0; i < state.quicklook.length; ++i) {\r\n                        if (state.visible[i] === item.sceneid) {\r\n                            item.quicklook = true;\r\n                            break;\r\n                        }           \r\n                    }\r\n                }\r\n\r\n                item.checked = false;\r\n                if (Array.isArray(state.cart)) {\r\n                    for (let i = 0; i < state.cart.length; ++i) {\r\n                        if (state.cart[i] === item.sceneid) {\r\n                            item.checked = true;\r\n                            break;\r\n                        }           \r\n                    }\r\n                }\r\n                                                 \r\n            });\r\n            resolve(state);\r\n        })\r\n        .catch (e => {\r\n            console.log(e);\r\n            resolve(state);\r\n        });\r\n    });\r\n}\r\n\r\nfunction get_cart (state) {\r\n    return new Promise (resolve => {\r\n        search (state.cart)\r\n        .then (items => {\r\n            state.cart = items;\r\n            resolve(state);\r\n        })\r\n        .catch (e => {\r\n            console.log(e);\r\n            resolve(state);\r\n        });\r\n    });\r\n}\r\n\r\nlet matches = /\\?([^&]+)/g.exec(window.location.search);\r\nif (matches.length > 1) {\r\n    let id = matches[1];\r\n    chain([\r\n        read_permalink,\r\n        get_items,\r\n        get_cart,\r\n    ], {id})\r\n    .then(state => {\r\n        let {\r\n            lang, \r\n            position,\r\n            bounds,\r\n            cadastre,\r\n            activeLayer,\r\n            drawingObjects,\r\n            searchCriteria: { \r\n                dateStart, dateEnd, \r\n                isYearly, \r\n                minCloudCover, maxCloudCover, \r\n                minAngle, maxAngle,\r\n                archive,\r\n                stereo,\r\n                satellites,\r\n            },\r\n            cart,\r\n            items,\r\n        } = state;\r\n        let rxDate = new RegExp ('(\\\\d{2})\\\\.(\\\\d{2})\\\\.(\\\\d{4})');\r\n        let d1 = rxDate.exec(dateStart);\r\n        let d2 = rxDate.exec(dateEnd);\r\n        let date = [`${d1[3]}-${d1[2]}-${d1[1]}`,`${d2[3]}-${d2[2]}-${d2[1]}`];\r\n        let st = satellites.reduce((a,i) => {\r\n            let s = ss[i];\r\n            let k = s.lastIndexOf('_L');\r\n            if (k > -1){                                        \r\n                let x = s.substr(0, k);\r\n                if (x === 'WV01') {\r\n                    a.pc.push (x);\r\n                }\r\n                else {\r\n                    a.ms.push (x);\r\n                }\r\n            }\r\n            else if (s in ['WV01', 'EROSA', 'EROSB']) {\r\n                a.pc.push (s);\r\n            }\r\n            else {\r\n                a.ms.push (s);\r\n            }\r\n            return a;\r\n        }, {ms: [], pc: []});\r\n        let objects = drawingObjects.map (item => {\r\n            let {name, color, checked} = item.properties;\r\n            return {\r\n                name: name,\r\n                geoJSON: item,\r\n                color: typeof color === 'string' && color !== '' ? `#${hex(color, 6)}` : '#0033FF',\r\n                visible: checked,\r\n            };\r\n        });        \r\n        let viewState = {\r\n            lang,\r\n            activeLayer,\r\n            drawingObjects: objects,\r\n            position,                \r\n            bounds,                \r\n            searchCriteria: {\r\n                date,\r\n                annually: isYearly,\r\n                angle: [minAngle, maxAngle],\r\n                clouds: [minCloudCover, maxCloudCover],\r\n                stereo,\r\n                archive,\r\n                satellites: st,\r\n            },\r\n            items,\r\n            cart,\r\n            cadastre,\r\n        };\r\n        localStorage.setItem('view_state', JSON.stringify(viewState));\r\n        window.location = `${window.location.origin}${window.location.pathname.substr(0, window.location.pathname.lastIndexOf('/'))}`;\r\n    });\r\n}"],"names":["EventTarget","listeners","type","callback","push","stack","i","l","length","splice","removeEventListener","event","Object","defineProperty","enumerable","configurable","writable","value","call","uniqueGlobalName","freeid","id","window","thing","sendCrossDomainJSONRequest","url","callbackParamName","errorCallback","script","document","createElement","setAttribute","callbackName","obj","getElementsByTagName","item","removeChild","sepSym","indexOf","onerror","Math","random","appendChild","AuthManager","authorizationEndpoint","userInfoEndpoint","redirectEndpointHtml","redirectEndpointAshx","credentialLoginEndpoint","clientId","_authorizationEndpoint","_userInfoEndpoint","_redirectEndpointHtml","_redirectEndpointAshx","_redirectEndpointAshx2","location","href","_credentialLoginEndpoint","_resourceServers","_clientId","cookieName","re","RegExp","cookie","replace","resourceServer","tasks","state","reduce","prev","next","then","Promise","resolve","reject","map","rs","sendGetRequest","concat","response","catch","e","_chain","search","parseQueryString","a","slice","split","o","s","params","error","Status","Result","Error","message","resp","arguments","_getUserInfoDeferred","authorizationGrant","setTimeout","body","querySelector","_processAuthorization","err","_authorizeResourceServers","scope","servers","Service","ServerId","State","bind","insertAdjacentHTML","arg","foreignServer","iframeContainer","authUrl","open","reload","createEvent","initEvent","dispatchEvent","self","login","password","encodeURIComponent","toLowerCase","getUserInfo","Message","promises","promise","copy","source","Array","isArray","Date","keys","k","extend","target","babelHelpers.typeof","DropdownWidget","options","title","trigger","direction","adjustWidth","showTopItem","titleClassName","$el","el","classList","add","$titleContainer","innerHTML","$dropdownContainer","style","display","$dropdownTitle","addEventListener","expand","collapse","_items","inst","position","$container","detail","dataId","je","currentTarget","getAttribute","_sortItems","_expanded","r","getBoundingClientRect","minWidth","width","containerEl","items","prototype","children","titleEl","positions","parseInt","maxPositionIndex","max","apply","insertBefore","DropdownMenuWidget","_view","_renderItem","join","dropDown","mouseTimeout","querySelectorAll","mouseIsOver","dd","className","link","newWindow","icon","fonticon","dropdown","_renderDropdown","placeholder","DEFAULT_LANGUAGE","Translations","_hash","lang","_language","language","tran","key","locale","getLanguage","Scanex","translations","T","addText","auth","AuthWidget","_authManager","authManager","_userInfo","_options","showAccountLink","accountLink","showMapLink","_render","Login","userName","FullName","Nickname","nickName","vm","getText","dropdownItems","iconClass","defaultMapLink","mapLink","dropdownMenuWidget","MenuWidget","appendTo","loginBtn","$iframeContainer","logoutBtn","logout","parseUri","str","parser","m","exec","uri","hostOnly","host","authority","requests","lastRequestId","uniquePrefix","processMessage","origin","dataStr","decodeURIComponent","data","dataObj","JSON","parse","request","CallbackName","iframe","parentNode","attachEvent","addQueryVariables","variables","oldQueryString","newQueryString","variable","hasOwnProperty","createPostIframe","src","Server","root","_root","requestUrl","img","Image","onload","errors","baseForm","requestURL","processResponse","parsedURL","protocol","originalFormAction","form","hiddenParamsDiv","appendFormParam","paramName","paramValue","input","submit","removeAttribute","ResourceServer","_id","$addResourceServer","sync","$getAntiCsrfToken","ErrorInfo","resourceServersInstances","resourceServersConstructors","getResourceServer","getAuthManager","chain","hex","number","h","toString","toUpperCase","from_gmx","fields","values","types","convertMercator","x","L","gmxUtil","geometryToGeoJSON","stereo","geomixergeojson","geoJSON","sceneid","EAST_HEMISPHERE","bounds","point","WEST_HEMISPHERE","WEST_HEMISPHERE2","LAYER_ID","ss","gmxResourceServer","read_permalink","get_query","ids","sendPostRequest","layer","geometry","pagesize","query","WrapStyle","get_items","selected","quicklook","forEach","visible","checked","cart","console","log","get_cart","matches","cadastre","activeLayer","drawingObjects","searchCriteria","dateStart","dateEnd","isYearly","minCloudCover","maxCloudCover","minAngle","maxAngle","archive","satellites","rxDate","d1","d2","date","st","lastIndexOf","substr","pc","ms","objects","properties","name","color","viewState","annually","angle","clouds","localStorage","setItem","stringify","pathname"],"mappings":"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"}